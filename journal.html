<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title data-translate="page_title">Potok ‚Äî Calendar</title>
  
  <script>
    // –£–±–∏—Ä–∞–µ–º Firebase –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
    console.log('üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ Firebase, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
  </script>

  <style>
    :root {
      --main: #19191B;
      --white: #ffffff;
      --text-2: #b3b3b3;
      --green: #34A853;
      
      --emotion-joyful: #34A853;
      --emotion-good: #5CDE6D;
      --emotion-so-so: #FFD527;
      --emotion-anxious: #FF7DB0;
      --emotion-sad: #4285F4;
      --emotion-bad: #E74639;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: var(--main);
      font-family: "Inter", sans-serif;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* Language Switcher */
    .language-switcher {
      position: fixed;
      top: 24px;
      right: calc(50vw - 163.5px);
      z-index: 200;
      display: flex;
      gap: 8px;
      background: rgba(255, 255, 255, 0.05);
      padding: 4px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
    }

    @media (max-width: 425px) {
      .language-switcher {
        right: 24px;
      }
    }

    .lang-btn {
      background: none;
      border: none;
      color: var(--text-2);
      font-size: 12px;
      font-weight: 500;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: "Inter", sans-serif;
    }

    .lang-btn.active {
      background: linear-gradient(135deg, #FFD527 8%, #34A853 85%, #4285F4 98%);
      color: white;
    }

    .lang-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .lang-btn.active:hover {
      background: linear-gradient(135deg, #FFD527 8%, #34A853 85%, #4285F4 98%);
    }

    /* Header with back button */
    .header {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 375px;
      width: 100%;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: var(--main);
      padding: 24px 24px 24px 24px;
      box-sizing: border-box;
    }

    .back-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 32px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      border: none;
      transition: background-color 0.2s;
      cursor: pointer;
    }

    .back-button:active {
      background-color: rgba(255, 255, 255, 0.2);
    }

    .back-arrow {
      width: 16px;
      height: 16px;
      color: var(--white);
    }

    /* Main container */
    .container {
      max-width: 375px;
      margin: 0 auto;
      padding: 105px 24px 24px 24px;
      display: flex;
      flex-direction: column;
      padding-bottom: 125px;
      box-sizing: border-box;
    }

    /* Calendar header */
    .calendar-header {
      margin-bottom: 48px;
      text-align: left;
    }

    .calendar-title {
      font-size: 24px;
      line-height: 32px;
      font-weight: 600;
      color: var(--white);
      margin: 0 0 4px 0;
      padding: 0;
    }

    .calendar-subtitle {
      font-size: 14px;
      line-height: 20px;
      font-weight: 400;
      color: var(--text-2);
      margin: 0;
      padding: 0;
    }

    /* Calendar grid */
    .calendar {
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 48px;
    }

    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .nav-button {
      background: none;
      border: none;
      color: var(--white);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: background-color 0.2s;
    }

    .nav-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .current-month {
      font-size: 16px;
      font-weight: 600;
      color: var(--white);
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 8px;
    }

    .weekday {
      text-align: center;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-2);
      padding: 8px 0;
    }

    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 400;
      color: var(--white);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .day:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .day.other-month {
      color: var(--text-2);
      opacity: 0.5;
    }

    .day.today {
      border: 2px solid var(--green);
    }

    .day.has-emotion {
      border: 2px solid transparent;
    }

    .day.emotion-joyful { background-color: var(--emotion-joyful); }
    .day.emotion-good { background-color: var(--emotion-good); }
    .day.emotion-so-so { background-color: var(--emotion-so-so); color: var(--main); }
    .day.emotion-anxious { background-color: var(--emotion-anxious); }
    .day.emotion-sad { background-color: var(--emotion-sad); }
    .day.emotion-bad { background-color: var(--emotion-bad); }

    /* Emotion picker modal */
    .emotion-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(8px);
    }

    .emotion-modal.active {
      display: flex;
    }

    .emotion-picker {
      background-color: var(--main);
      border-radius: 16px;
      padding: 24px 20px 20px 20px;
      max-width: 280px;
      width: 85%;
      border: 1px solid rgba(255, 255, 255, 0.15);
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }

    .emotion-picker-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .emotion-picker-date {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .emotion-picker-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--white);
      line-height: 1.2;
      margin: 0;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--text-2);
      cursor: pointer;
      padding: 6px;
      margin: -6px -6px -6px 6px;
      border-radius: 6px;
      transition: all 0.2s;
      font-size: 14px;
      line-height: 1;
    }

    .close-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }

    .emotions-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 0;
    }

    .emotion-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 16px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
      background-color: rgba(255, 255, 255, 0.03);
    }

    .emotion-option:hover {
      background-color: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .emotion-option:active {
      transform: translateY(0);
    }

    .emotion-color {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    .emotion-option:hover .emotion-color {
      transform: scale(1.1);
    }

    .emotion-name {
      font-size: 12px;
      font-weight: 500;
      color: var(--white);
      text-align: center;
    }

    /* Tab bar */
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 375px;
      background-color: var(--main);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1000;
      
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
      padding-bottom: calc(12px + 20px);
      padding-bottom: calc(12px + env(safe-area-inset-bottom, 20px));
    }

    .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      line-height: 18px;
      font-weight: 400;
      color: var(--text-2);
      gap: 8px;
    }

    .tab.active {
      font-weight: 600;
      color: var(--green);
    }

    .tab.active img {
      filter: brightness(1.5);
    }

    .tab img {
      width: 24px;
      height: 24px;
      transition: transform 0.1s, filter 0.1s;
    }

    .tab img:active {
      transform: scale(0.9);
      filter: brightness(1.5);
    }

    /* Loading state */
    .loading {
      text-align: center;
      color: var(--text-2);
      font-size: 14px;
      margin: 24px 0;
    }
  </style>
</head>
<body>
  <!-- Language Switcher -->
  <div class="language-switcher">
    <button class="lang-btn active" id="enBtn">EN</button>
    <button class="lang-btn" id="ruBtn">RU</button>
  </div>

  <!-- Header with back button -->
  <div class="header">
    <button class="back-button" onclick="window.history.back()">
      <svg class="back-arrow" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <div></div>
  </div>

  <div class="container">
    <!-- Calendar header -->
    <div class="calendar-header">
      <h1 class="calendar-title" id="calendarTitle">–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç</h1>
      <p class="calendar-subtitle" id="calendarSubtitle">–ù–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç–µ, –º—ã —Å–∞–º–∏ –≤ —à–æ–∫–µ</p>
    </div>

    <!-- Calendar -->
    <div class="calendar">
      <div class="calendar-nav">
        <button class="nav-button" id="prevMonth">‚Üê</button>
        <div class="current-month" id="currentMonth"></div>
        <button class="nav-button" id="nextMonth">‚Üí</button>
      </div>
      
      <div class="weekdays">
        <div class="weekday" data-translate="monday">Mon</div>
        <div class="weekday" data-translate="tuesday">Tue</div>
        <div class="weekday" data-translate="wednesday">Wed</div>
        <div class="weekday" data-translate="thursday">Thu</div>
        <div class="weekday" data-translate="friday">Fri</div>
        <div class="weekday" data-translate="saturday">Sat</div>
        <div class="weekday" data-translate="sunday">Sun</div>
      </div>
      
      <div class="days-grid" id="daysGrid"></div>
    </div>

    <div class="loading" id="loadingText" style="display: none;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
  </div>

  <!-- Emotion picker modal -->
  <div class="emotion-modal" id="emotionModal">
    <div class="emotion-picker">
      <div class="emotion-picker-header">
        <div>
          <div class="emotion-picker-date" id="selectedDateText">–í–¢–û–†–ù–ò–ö, 3 –ò–Æ–ù–Ø 2025 –ì.</div>
          <h3 class="emotion-picker-title" data-translate="how_feeling">–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?</h3>
        </div>
        <button class="close-button" id="closeModal">‚úï</button>
      </div>
      
      <div class="emotions-grid">
        <div class="emotion-option" data-emotion="joyful">
          <div class="emotion-color" style="background-color: var(--emotion-joyful);"></div>
          <div class="emotion-name" data-translate="emotion_joyful">–†–∞–¥–æ—Å—Ç–Ω–æ</div>
        </div>
        <div class="emotion-option" data-emotion="good">
          <div class="emotion-color" style="background-color: var(--emotion-good);"></div>
          <div class="emotion-name" data-translate="emotion_good">–•–æ—Ä–æ—à–æ</div>
        </div>
        <div class="emotion-option" data-emotion="so-so">
          <div class="emotion-color" style="background-color: var(--emotion-so-so);"></div>
          <div class="emotion-name" data-translate="emotion_so_so">–¢–∞–∫ —Å–µ–±–µ</div>
        </div>
        <div class="emotion-option" data-emotion="anxious">
          <div class="emotion-color" style="background-color: var(--emotion-anxious);"></div>
          <div class="emotion-name" data-translate="emotion_anxious">–¢—Ä–µ–≤–æ–∂–Ω–æ</div>
        </div>
        <div class="emotion-option" data-emotion="sad">
          <div class="emotion-color" style="background-color: var(--emotion-sad);"></div>
          <div class="emotion-name" data-translate="emotion_sad">–ì—Ä—É—Å—Ç–Ω–æ</div>
        </div>
        <div class="emotion-option" data-emotion="bad">
          <div class="emotion-color" style="background-color: var(--emotion-bad);"></div>
          <div class="emotion-name" data-translate="emotion_bad">–ü–ª–æ—Ö–æ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab bar -->
  <footer class="tab-bar">
    <a href="index.html" class="tab">
      <img src="img/home.svg" alt="Today">
      <div data-translate="tab_today">Today</div>
    </a>
    <a href="practices.html" class="tab">
      <img src="img/practices.svg" alt="Practices">
      <div data-translate="tab_practices">Practices</div>
    </a>
    <a href="journal.html" class="tab">
      <img src="img/journal.svg" alt="Journal">
      <div data-translate="tab_journal">Journal</div>
    </a>
  </footer>

  <script>
    // Translations
    const translations = {
      en: {
        page_title: "Potok ‚Äî Calendar",
        monday: "Mon",
        tuesday: "Tue", 
        wednesday: "Wed",
        thursday: "Thu",
        friday: "Fri",
        saturday: "Sat",
        sunday: "Sun",
        how_feeling: "How are you feeling?",
        emotion_joyful: "Joyful",
        emotion_good: "Good",
        emotion_so_so: "So-so",
        emotion_anxious: "Anxious", 
        emotion_sad: "Sad",
        emotion_bad: "Bad",
        tab_today: "Today",
        tab_practices: "Practices",
        tab_journal: "Journal"
      },
      ru: {
        page_title: "Potok ‚Äî –ö–∞–ª–µ–Ω–¥–∞—Ä—å",
        monday: "–ü–Ω",
        tuesday: "–í—Ç",
        wednesday: "–°—Ä", 
        thursday: "–ß—Ç",
        friday: "–ü—Ç",
        saturday: "–°–±",
        sunday: "–í—Å",
        how_feeling: "–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?",
        emotion_joyful: "–†–∞–¥–æ—Å—Ç–Ω–æ",
        emotion_good: "–•–æ—Ä–æ—à–æ", 
        emotion_so_so: "–¢–∞–∫ —Å–µ–±–µ",
        emotion_anxious: "–¢—Ä–µ–≤–æ–∂–Ω–æ",
        emotion_sad: "–ì—Ä—É—Å—Ç–Ω–æ",
        emotion_bad: "–ü–ª–æ—Ö–æ",
        tab_today: "–°–µ–≥–æ–¥–Ω—è",
        tab_practices: "–ü—Ä–∞–∫—Ç–∏–∫–∏", 
        tab_journal: "–ñ—É—Ä–Ω–∞–ª"
      }
    };

    // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    const calendarHeaders = [
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç", subtitle: "–ù–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç–µ, –º—ã —Å–∞–º–∏ –≤ —à–æ–∫–µ" },
      { title: "–ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?", subtitle: "–û—Ç–≤–µ—Ç ¬´—Ç–∞–∫ —Å–µ–±–µ¬ª —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è" },
      { title: "–ú–æ–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ–Ω—å", subtitle: "–ê –º–æ–∂–Ω–æ –∏ –Ω–µ –∑–∞–ø–æ–ª–Ω—è—Ç—å. –ê —Å—É–¥—å–∏ –∫—Ç–æ?" },
      { title: "–û—á–µ—Ä–µ–¥–Ω–æ–π –¥–µ–Ω—å", subtitle: "–°—É–¥—è –ø–æ –æ—â—É—â–µ–Ω–∏—è–º ‚Äî filler episode" },
      { title: "–ß–µ–∫-–∏–Ω –ø–æ –æ—â—É—â–µ–Ω–∏—è–º", subtitle: "–ë–µ–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏. –ú—ã –Ω–µ –≤ Notion" },
      { title: "–ú–æ–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏", subtitle: "–ú–æ–∂–Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–Ω–æ—Å–∏—Ç—å. –¢–∞–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –∂–¥—ë—Ç", subtitle: "–ê —á–µ–≥–æ ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–Ω—è–ª" },
      { title: "–°–ª–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω", subtitle: "–ì–ª—É–±–∏–Ω—ã –Ω–µ—Ç. –≠—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç", subtitle: "–ö–∞–∫ –∏ –≤—Å–µ ‚Äî –∫–æ–µ-–∫–∞–∫" },
      { title: "–î–µ–Ω—å –æ–∂–∏–¥–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è", subtitle: "–ò –Ω–µ –¥–µ–ª–∞–µ—Ç –∏–∑ —ç—Ç–æ–≥–æ —Ç—Ä–∞–≥–µ–¥–∏—é" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∫–ª—é—á—ë–Ω", subtitle: "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –∫–∞–∫ –º–æ–∂–µ—Ç." },
      { title: "–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ", subtitle: "–ó–Ω–∞—á–µ–Ω–∏—è —É –Ω–µ–≥–æ –Ω–µ—Ç" },
      { title: "–Ø—á–µ–π–∫–∞ –∂–¥—ë—Ç —Å–∏–≥–Ω–∞–ª–∞", subtitle: "–ò —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –Ω–µ –∑–∞–≤–∏—Å–Ω—É—Ç—å" },
      { title: "–Ø—á–µ–π–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞", subtitle: "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ –º–æ–ª—á–∏—Ç" },
      { title: "–°–ª–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω", subtitle: "–ß–∏—Å—Ç–æ –Ω–∞ —É–¥–∞—á–µ" },
      { title: "–î–µ–Ω—å –≥–æ—Ç–æ–≤ –∫ –æ—Ç–º–µ—Ç–∫–µ", subtitle: "–ù–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç, –Ω–µ –æ–±–∏–∂–∞–µ—Ç—Å—è" },
      { title: "–Ø—á–µ–π–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞", subtitle: "–ù–µ —Å–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ, –∫–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ" },
      { title: "–í–Ω—É—Ç—Ä–∏ –∫–∞–∫?", subtitle: "–ï—Å–ª–∏ –∫–∞–∫ –≤ –ø–∞–∫–µ—Ç–µ —Å –ø–∞–∫–µ—Ç–∞–º–∏ ‚Äî –Ω–∞–∂–º–∏ –∏ –¥—ã—à–∏" },
      { title: "–ö–∞–∫ –∏–¥—ë—Ç –¥–µ–Ω—å?", subtitle: "–ï—Å–ª–∏ –∏–¥—ë—Ç –±–æ–∫–æ–º ‚Äî –Ω–µ –º–µ—à–∞–π, –ø—É—Å—Ç—å –∏–¥—ë—Ç" },
      { title: "–¢–æ—á–∫–∞ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ", subtitle: "–° –∫–∞–∫–∏–º-—Ç–æ —Ñ–æ–Ω–æ–º. –ö–∞–∫–∏–º ‚Äî –≤–∏–¥–Ω–æ —Ç–µ–±–µ" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∫–ª—é—á—ë–Ω", subtitle: "–î—Ä–∞–º–∞ ‚Äî –Ω–µ –ø–æ –û—Ä—É—ç–ª–ª—É, –Ω–æ –±–ª–∏–∑–∫–æ" },
      { title: "–î–µ–Ω—å –ø–æ—è–≤–∏–ª—Å—è", subtitle: "–ú—ã —É–¥–∏–≤–ª–µ–Ω—ã –Ω–µ –º–µ–Ω—å—à–µ" },
      { title: "–û—á–µ—Ä–µ–¥–Ω–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Å—É—Ç–æ–∫", subtitle: "–° —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç", subtitle: "–ö–∞–∫ Windows XP –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –¥—ã—Ö–∞–Ω–∏–∏" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∫–ª—é—á—ë–Ω", subtitle: "–†–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É ¬´–∏ —Ç–∞–∫ —Å–æ–π–¥—ë—Ç¬ª" },
      { title: "–û—á–µ—Ä–µ–¥–Ω–æ–π –¥–µ–Ω—å –æ—Ç–∫—Ä—ã—Ç", subtitle: "–ë—É–¥–µ—Ç –ª–∏ –æ–Ω –∑–∞–∫—Ä—ã—Ç ‚Äî –Ω–µ –æ–±–µ—â–∞–µ–º" },
      { title: "–§–æ—Ä–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞", subtitle: "–ñ–µ–ª–∞–Ω–∏–µ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ" },
      { title: "–ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤–∫–ª—é—á—ë–Ω", subtitle: "–ê –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å ‚Äî –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ" },
      { title: "–ó–∞–ø–∏—Å—å –≤–æ–∑–º–æ–∂–Ω–∞", subtitle: "–ò–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –±–∞–≥ –≤ –ú–∞—Ç—Ä–∏—Ü–µ" }
    ];

    // Calendar functionality
    class EmotionCalendar {
      constructor() {
        this.currentDate = new Date();
        this.selectedDate = null;
        this.emotions = {};
        this.userId = this.generateUserId();
        
        this.initializeElements();
        this.setupEventListeners();
        this.updateCalendarHeader();
        this.renderCalendar();
        this.loadEmotions();
      }

      generateUserId() {
        try {
          let userId = localStorage.getItem('potok_user_id');
          if (!userId) {
            userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            localStorage.setItem('potok_user_id', userId);
          }
          return userId;
        } catch (error) {
          console.warn('localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π ID');
          return 'temp_user_' + Date.now();
        }
      }

      initializeElements() {
        this.currentMonthElement = document.getElementById('currentMonth');
        this.daysGridElement = document.getElementById('daysGrid');
        this.emotionModal = document.getElementById('emotionModal');
        this.calendarTitle = document.getElementById('calendarTitle');
        this.calendarSubtitle = document.getElementById('calendarSubtitle');
        this.loadingText = document.getElementById('loadingText');
      }

      setupEventListeners() {
        // Navigation buttons
        document.getElementById('prevMonth').addEventListener('click', () => {
          this.currentDate.setMonth(this.currentDate.getMonth() - 1);
          this.renderCalendar();
          this.updateCalendarHeader();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
          this.currentDate.setMonth(this.currentDate.getMonth() + 1);
          this.renderCalendar();
          this.updateCalendarHeader();
        });

        // Modal events
        this.emotionModal.addEventListener('click', (e) => {
          if (e.target === this.emotionModal) {
            this.closeModal();
          }
        });

        document.getElementById('closeModal').addEventListener('click', () => {
          this.closeModal();
        });

        // Emotion options
        document.querySelectorAll('.emotion-option').forEach(option => {
          option.addEventListener('click', () => {
            const emotion = option.dataset.emotion;
            this.setEmotion(emotion);
          });
        });
      }

      updateCalendarHeader() {
        const headerIndex = Math.floor(Math.random() * calendarHeaders.length);
        const header = calendarHeaders[headerIndex];
        
        this.calendarTitle.textContent = header.title;
        this.calendarSubtitle.textContent = header.subtitle;
      }

      renderCalendar() {
        const year = this.currentDate.getFullYear();
        const month = this.currentDate.getMonth();
        
        // Update month display
        const monthNames = [
          '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
          '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
        ];
        this.currentMonthElement.textContent = `${monthNames[month]} ${year}`;

        // Clear previous days
        this.daysGridElement.innerHTML = '';

        // Get first day of month and days in month
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        
        // Get first day of week (Monday = 0)
        let startOfWeek = firstDay.getDay();
        startOfWeek = startOfWeek === 0 ? 6 : startOfWeek - 1;

        // Add previous month days
        const prevMonth = new Date(year, month - 1, 0);
        for (let i = startOfWeek - 1; i >= 0; i--) {
          const day = prevMonth.getDate() - i;
          const dayElement = this.createDayElement(day, true);
          this.daysGridElement.appendChild(dayElement);
        }

        // Add current month days
        for (let day = 1; day <= daysInMonth; day++) {
          const dayElement = this.createDayElement(day, false);
          this.daysGridElement.appendChild(dayElement);
        }

        // Add next month days to fill grid
        const totalCells = this.daysGridElement.children.length;
        const cellsNeeded = Math.ceil(totalCells / 7) * 7;
        for (let day = 1; totalCells + day - 1 < cellsNeeded; day++) {
          const dayElement = this.createDayElement(day, true);
          this.daysGridElement.appendChild(dayElement);
        }
      }

      createDayElement(day, isOtherMonth) {
        const dayElement = document.createElement('div');
        dayElement.className = 'day';
        dayElement.textContent = day;

        if (isOtherMonth) {
          dayElement.classList.add('other-month');
          return dayElement;
        }

        // Check if today
        const today = new Date();
        const currentYear = this.currentDate.getFullYear();
        const currentMonth = this.currentDate.getMonth();
        
        if (currentYear === today.getFullYear() && 
            currentMonth === today.getMonth() && 
            day === today.getDate()) {
          dayElement.classList.add('today');
        }

        // Add emotion if exists
        const dateKey = `${currentYear}-${currentMonth}-${day}`;
        if (this.emotions[dateKey]) {
          dayElement.classList.add('has-emotion', `emotion-${this.emotions[dateKey]}`);
        }

        // Add click listener
        dayElement.addEventListener('click', () => {
          this.openModal(dateKey);
        });

        return dayElement;
      }

      openModal(dateKey) {
        this.selectedDate = dateKey;
        
        // Update date display
        const [year, month, day] = dateKey.split('-').map(Number);
        const date = new Date(year, month, day);
        const dateText = this.formatSelectedDate(date);
        document.getElementById('selectedDateText').textContent = dateText;
        
        this.emotionModal.classList.add('active');
      }

      formatSelectedDate(date) {
        const days = ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï', '–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö', '–í–¢–û–†–ù–ò–ö', '–°–†–ï–î–ê', '–ß–ï–¢–í–ï–†–ì', '–ü–Ø–¢–ù–ò–¶–ê', '–°–£–ë–ë–û–¢–ê'];
        const months = ['–Ø–ù–í–ê–†–Ø', '–§–ï–í–†–ê–õ–Ø', '–ú–ê–†–¢–ê', '–ê–ü–†–ï–õ–Ø', '–ú–ê–Ø', '–ò–Æ–ù–Ø', '–ò–Æ–õ–Ø', '–ê–í–ì–£–°–¢–ê', '–°–ï–ù–¢–Ø–ë–†–Ø', '–û–ö–¢–Ø–ë–†–Ø', '–ù–û–Ø–ë–†–Ø', '–î–ï–ö–ê–ë–†–Ø'];
        
        const dayName = days[date.getDay()];
        const day = date.getDate();
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        
        return `${dayName}, ${day} ${month} ${year} –ì.`;
      }

      closeModal() {
        this.emotionModal.classList.remove('active');
        this.selectedDate = null;
      }

      async setEmotion(emotion) {
        if (!this.selectedDate) return;
        
        // If same emotion is already selected, remove it
        if (this.emotions[this.selectedDate] === emotion) {
          delete this.emotions[this.selectedDate];
        } else {
          // Set new emotion
          this.emotions[this.selectedDate] = emotion;
        }
        
        // Save to localStorage
        this.saveToLocalStorage();
        
        this.renderCalendar();
        this.closeModal();
        this.updateCalendarHeader();
      }

      loadEmotions() {
        this.loadingText.style.display = 'block';
        
        try {
          const saved = localStorage.getItem(`potok_emotions_${this.userId}`);
          if (saved) {
            this.emotions = JSON.parse(saved);
          }
          this.renderCalendar();
          console.log('‚úÖ –≠–º–æ—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage');
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', error);
          this.emotions = {};
        } finally {
          this.loadingText.style.display = 'none';
        }
      }

      saveToLocalStorage() {
        try {
          localStorage.setItem(`potok_emotions_${this.userId}`, JSON.stringify(this.emotions));
          console.log('‚úÖ –≠–º–æ—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
        }
      }
    }

    // Translator class (same as practices.html)
    class Translator {
      constructor() {
        console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ CALENDAR.HTML...');
        
        this.localStorageAvailable = this.checkLocalStorageAvailability();
        
        this.currentLang = this.getLanguageFromURL() || 
                          (this.localStorageAvailable ? this.getLanguageFromStorage() : null) || 
                          'en';
        
        console.log(`üåê –í—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫: ${this.currentLang}`);
        
        this.init();
      }

      checkLocalStorageAvailability() {
        try {
          const testKey = 'test_storage_' + Date.now();
          localStorage.setItem(testKey, 'test');
          localStorage.removeItem(testKey);
          return true;
        } catch (error) {
          console.log(`‚ö†Ô∏è localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`);
          return false;
        }
      }

      getLanguageFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const langFromUrl = urlParams.get('lang');
        console.log(`üîó –Ø–∑—ã–∫ –∏–∑ URL: ${langFromUrl}`);
        return langFromUrl;
      }

      getLanguageFromStorage() {
        if (!this.localStorageAvailable) return null;
        
        try {
          const langFromStorage = localStorage.getItem('potok_language');
          console.log(`üíæ –Ø–∑—ã–∫ –∏–∑ localStorage: ${langFromStorage}`);
          return langFromStorage;
        } catch (error) {
          console.log(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage: ${error.message}`);
          return null;
        }
      }

      init() {
        this.updatePage();
        this.updateLanguageButtons();
        this.updatePageLinks();
        this.setupLanguageButtons();
        document.documentElement.lang = this.currentLang;
        
        console.log(`‚úÖ –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ CALENDAR.HTML –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —è–∑—ã–∫–æ–º: ${this.currentLang}`);
      }

      setupLanguageButtons() {
        document.getElementById('enBtn')?.addEventListener('click', () => {
          console.log('üîò –ö–ª–∏–∫ –ø–æ EN –≤ CALENDAR.HTML');
          this.setLanguage('en');
        });
        
        document.getElementById('ruBtn')?.addEventListener('click', () => {
          console.log('üîò –ö–ª–∏–∫ –ø–æ RU –≤ CALENDAR.HTML');
          this.setLanguage('ru');
        });
      }

      setLanguage(lang) {
        console.log(`üîÑ –°–º–µ–Ω–∞ —è–∑—ã–∫–∞ –Ω–∞: ${lang} –≤ CALENDAR.HTML`);
        
        this.currentLang = lang;
        
        if (this.localStorageAvailable) {
          try {
            localStorage.setItem('potok_language', lang);
            console.log(`‚úÖ –Ø–∑—ã–∫ ${lang} —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage`);
          } catch (error) {
            console.log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage: ${error.message}`);
          }
        }
        
        try {
          const newUrl = `${window.location.pathname}?lang=${lang}`;
          window.history.replaceState({}, '', newUrl);
          console.log(`‚úÖ URL –æ–±–Ω–æ–≤–ª–µ–Ω: ${newUrl}`);
        } catch (error) {
          console.log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å URL: ${error.message}`);
        }
        
        this.updatePage();
        this.updateLanguageButtons();
        this.updatePageLinks();
        
        document.documentElement.lang = lang;
        
        console.log(`üåê –Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${lang} –≤ CALENDAR.HTML`);
      }

      updatePageLinks() {
        const links = document.querySelectorAll('a[href$=".html"], a[href*=".html"]');
        let updateCount = 0;
        
        links.forEach(link => {
          let href = link.getAttribute('href');
          
          if (href.startsWith('http') || href.startsWith('//')) return;
          
          if (href.includes('?lang=')) {
            href = href.split('?')[0];
          }
          
          if (href.includes('#')) {
            const parts = href.split('#');
            href = parts[0];
          }
          
          const separator = href.includes('?') ? '&' : '?';
          const newHref = `${href}${separator}lang=${this.currentLang}`;
          link.setAttribute('href', newHref);
          updateCount++;
        });
        
        console.log(`üîó –û–±–Ω–æ–≤–ª–µ–Ω–æ ${updateCount} —Å—Å—ã–ª–æ–∫ —Å lang=${this.currentLang} –≤ CALENDAR.HTML`);
      }

      translate(key) {
        return translations[this.currentLang]?.[key] || translations.en[key] || key;
      }

      updatePage() {
        document.querySelectorAll('[data-translate]').forEach(element => {
          const key = element.getAttribute('data-translate');
          const translation = this.translate(key);
          
          if (element.tagName === 'TITLE') {
            element.textContent = translation;
          } else {
            element.textContent = translation;
          }
        });
        
        console.log(`üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ ${document.querySelectorAll('[data-translate]').length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–∞`);
      }

      updateLanguageButtons() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.textContent.toLowerCase() === this.currentLang) {
            btn.classList.add('active');
            btn.style.background = 'linear-gradient(135deg, #FFD527 8%, #34A853 85%, #4285F4 98%)';
          } else {
            btn.style.background = '';
          }
        });
      }
    }

    // Initialize app immediately
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üìÖ DOM –∑–∞–≥—Ä—É–∂–µ–Ω –¥–ª—è Calendar.html');
      
      // Initialize translator
      window.translator = new Translator();
      
      // Initialize calendar 
      window.calendar = new EmotionCalendar();
      
      console.log('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
    });
  </script>
</body>
</html>