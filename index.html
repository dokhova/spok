<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#19191B" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title data-translate="page_title">Potok ‚Äî Home</title>
  
  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4834XVE45Z"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4834XVE45Z', {
      custom_map: {
        'custom_parameter_1': 'telegram_user_id',
        'custom_parameter_2': 'practice_type'
      }
    });
  </script>
  
  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Telegram Analytics SDK -->
  <script async src="https://tganalytics.xyz/index.js" onload="initAnalytics()" type="text/javascript"></script>
  
  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ SDK
    window.telegramAnalyticsReady = false;
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –§—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è initAnalytics() —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    function initAnalytics() {
      // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±—Ä–∞–ª –ª–∏—à–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ - —Å–ª–µ–¥—É—é –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
      window.telegramAnalytics.init({
        token: 'eyJhcHBfbmFtZSI6InNwb2tzcGFjZV9taW5pYXBwIiwiYXBwX3VybCI6Imh0dHBzOi8vdC5tZS9zcG9rc3BhY2Vib3QiLCJhcHBfZG9tYWluIjoiaHR0cHM6Ly93d3cuc3Bva3NwYWNlLmNvbSJ9!lFfIwgzlTn6nLOr9lypkmjfCVI8vz3h36Dsor4dISRw=', // SDK Auth token received via @DataChief_bot
        appName: 'spokspace_miniapp' // The analytics identifier you entered in @DataChief_bot
      });
      
      window.telegramAnalyticsReady = true;
      console.log('‚úÖ Telegram Analytics SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏');
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
      if (window.telegramAnalytics && typeof window.telegramAnalytics.track === 'function') {
        window.telegramAnalytics.track('app_initialized', {
          timestamp: Date.now(),
          page: 'index',
          version: '1.0.0'
        });
        console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ app_initialized –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
      }
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
      if (window.pendingAnalyticsEvents && window.pendingAnalyticsEvents.length > 0) {
        window.pendingAnalyticsEvents.forEach(({eventName, parameters}) => {
          trackEvent(eventName, parameters);
        });
        window.pendingAnalyticsEvents = [];
        console.log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏');
      }
    }

    window.pendingAnalyticsEvents = [];

    // –ë–´–°–¢–†–ê–Ø –≤–µ—Ä—Å–∏—è trackEvent —á–µ—Ä–µ–∑ FastAnalytics
    function trackEvent(eventName, parameters = {}) {
      fastAnalytics.track(eventName, parameters);
    }

    // –°–¢–ê–†–ê–Ø –º–µ–¥–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è trackEvent (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) 
    function trackEventSlow(eventName, parameters = {}) {
      const startTime = performance.now();
      console.log(`üîç [–ü–†–û–§–ò–õ–¨] –ù–∞—á–∞–ª–æ trackEvent: ${eventName}`);
      
      // –≠–¢–ê–ü 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–±—ã—Å—Ç—Ä–æ)
      const dataStart = performance.now();
      const eventData = {
        ...parameters,
        timestamp: Date.now(),
        app_name: 'spokspace_miniapp',
        page: window.location.pathname
      };
      console.log(`üîç [–ü–†–û–§–ò–õ–¨] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö trackEvent: ${(performance.now() - dataStart).toFixed(2)}ms`);

      // –≠–¢–ê–ü 2: Telegram Analytics (–ú–û–ñ–ï–¢ –ë–´–¢–¨ –ú–ï–î–õ–ï–ù–ù–´–ú!)
      const tgStart = performance.now();
      if (!window.telegramAnalyticsReady) {
        console.log('üìä Telegram Analytics –Ω–µ –≥–æ—Ç–æ–≤, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å:', eventName, eventData);
        window.pendingAnalyticsEvents.push({eventName, parameters: eventData});
      } else if (window.telegramAnalytics && typeof window.telegramAnalytics.track === 'function') {
        try {
          window.telegramAnalytics.track(eventName, eventData);
          console.log('üìä Telegram Analytics event –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:', eventName, eventData);
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ Telegram Analytics:', error);
        }
      } else {
        console.error('‚ùå telegramAnalytics.track –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
      }
      console.log(`üîç [–ü–†–û–§–ò–õ–¨] Telegram Analytics: ${(performance.now() - tgStart).toFixed(2)}ms`);

      // –≠–¢–ê–ü 3: Google Analytics (–ú–û–ñ–ï–¢ –ë–´–¢–¨ –û–ß–ï–ù–¨ –ú–ï–î–õ–ï–ù–ù–´–ú!)
      const gaStart = performance.now();
      if (typeof gtag !== 'undefined') {
        try {
          gtag('event', eventName, {
            event_category: 'telegram_mini_app',
            event_label: parameters.practice_type || 'unknown',
            custom_parameter_1: parameters.user_id,
            custom_parameter_2: parameters.practice_type,
            value: 1
          });
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ Google Analytics:', error);
        }
      }
      console.log(`üîç [–ü–†–û–§–ò–õ–¨] Google Analytics: ${(performance.now() - gaStart).toFixed(2)}ms`);
      
      const totalTime = performance.now() - startTime;
      console.log(`üîç [–ü–†–û–§–ò–õ–¨] –û–ë–©–ï–ï –í–†–ï–ú–Ø trackEvent: ${totalTime.toFixed(2)}ms`);
      
      if (totalTime > 100) {
        console.warn(`‚ö†Ô∏è [–ü–†–û–§–ò–õ–¨] –ú–ï–î–õ–ï–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê! trackEvent –∑–∞–Ω—è–ª–∞ ${totalTime.toFixed(2)}ms`);
      }
    }

    // –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–ê–Ø —Å–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ UI
    class FastAnalytics {
      constructor() {
        this.eventQueue = [];
        this.batchSize = 5;
        this.batchDelay = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞
        this.processingBatch = false;
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ—Ä–µ–¥–∏
        this.startBatchProcessor();
      }
      
      track(eventName, parameters = {}) {
        console.log(`üìä [FAST] –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å: ${eventName}`);
        
        const eventData = {
          eventName,
          parameters: {
            ...parameters,
            timestamp: Date.now(),
            app_name: 'spokspace_miniapp',
            page: window.location.pathname
          }
        };
        
        this.eventQueue.push(eventData);
        
        // –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å —Å—Ç–∞–ª–∞ –±–æ–ª—å—à–æ–π, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
        if (this.eventQueue.length >= this.batchSize && !this.processingBatch) {
          this.processBatch();
        }
      }
      
      startBatchProcessor() {
        setInterval(() => {
          if (this.eventQueue.length > 0 && !this.processingBatch) {
            this.processBatch();
          }
        }, this.batchDelay);
      }
      
      async processBatch() {
        if (this.processingBatch || this.eventQueue.length === 0) return;
        
        this.processingBatch = true;
        const batch = this.eventQueue.splice(0, this.batchSize);
        
        console.log(`üìä [FAST] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º batch –∏–∑ ${batch.length} —Å–æ–±—ã—Ç–∏–π`);
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ batch
        for (const event of batch) {
          try {
            await this.sendEvent(event.eventName, event.parameters);
          } catch (error) {
            console.error('‚ùå [FAST] –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è:', error);
          }
        }
        
        this.processingBatch = false;
      }
      
      async sendEvent(eventName, parameters) {
        // Telegram Analytics
        if (window.telegramAnalyticsReady && window.telegramAnalytics?.track) {
          try {
            window.telegramAnalytics.track(eventName, parameters);
          } catch (error) {
            console.error('‚ùå [FAST] Telegram Analytics –æ—à–∏–±–∫–∞:', error);
          }
        }
        
        // Google Analytics
        if (typeof gtag !== 'undefined') {
          try {
            gtag('event', eventName, {
              event_category: 'telegram_mini_app',
              event_label: parameters.practice_type || 'unknown',
              custom_parameter_1: parameters.user_id,
              custom_parameter_2: parameters.practice_type,
              value: 1
            });
          } catch (error) {
            console.error('‚ùå [FAST] Google Analytics –æ—à–∏–±–∫–∞:', error);
          }
        }
      }
    }
    
    // –°–æ–∑–¥–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    const fastAnalytics = new FastAnalytics();

    // –ò–ù–°–¢–†–£–ú–ï–ù–¢ –î–õ–Ø –û–¢–õ–ê–î–ö–ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò
    class PerformanceDebugger {
      constructor() {
        this.totalEmotionSets = 0;
        this.slowOperations = [];
        this.startMonitoring();
      }

      startMonitoring() {
        console.log(`üîç [–î–ï–ë–ê–ì–ì–ï–†] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—â–µ–Ω`);
        console.log(`üîç [–î–ï–ë–ê–ì–ì–ï–†] –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —ç–º–æ—Ü–∏—é –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏`);
        
        // –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –æ–±—â—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        setInterval(() => {
          if (this.slowOperations.length > 0) {
            console.warn(`‚ö†Ô∏è [–î–ï–ë–ê–ì–ì–ï–†] –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ ${this.slowOperations.length} –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É`);
            this.slowOperations.forEach(op => {
              console.warn(`   - ${op.operation}: ${op.time}ms`);
            });
            this.slowOperations = [];
          }
        }, 60000); // –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
      }

      recordSlowOperation(operation, time) {
        this.slowOperations.push({ operation, time, timestamp: Date.now() });
      }

      logEmotionSetComplete(totalTime) {
        this.totalEmotionSets++;
        console.log(`üîç [–î–ï–ë–ê–ì–ì–ï–†] –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º–æ—Ü–∏–∏ #${this.totalEmotionSets} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${totalTime.toFixed(2)}ms`);
        
        if (totalTime > 500) {
          console.error(`üö® [–î–ï–ë–ê–ì–ì–ï–†] –ö–†–ò–¢–ò–ß–ï–°–ö–ò –ú–ï–î–õ–ï–ù–ù–û! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–º–µ—Ç–∏—Ç –∑–∞–¥–µ—Ä–∂–∫—É!`);
          this.recordSlowOperation('setEmotion', totalTime);
        } else if (totalTime > 200) {
          console.warn(`‚ö†Ô∏è [–î–ï–ë–ê–ì–ì–ï–†] –ú–ï–î–õ–ï–ù–ù–û! –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è`);
          this.recordSlowOperation('setEmotion', totalTime);
        } else if (totalTime > 100) {
          console.log(`üíõ [–î–ï–ë–ê–ì–ì–ï–†] –ó–∞–º–µ—Ç–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, –Ω–æ –ø—Ä–∏–µ–º–ª–µ–º–æ`);
        } else {
          console.log(`‚úÖ [–î–ï–ë–ê–ì–ì–ï–†] –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å!`);
        }
      }

      generateReport() {
        console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] === –û–¢–ß–ï–¢ –û –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò ===`);
        console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] –í—Å–µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–æ–∫ —ç–º–æ—Ü–∏–π: ${this.totalEmotionSets}`);
        console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] –ú–µ–¥–ª–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π: ${this.slowOperations.length}`);
        
        if (this.slowOperations.length > 0) {
          console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:`);
          console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ localStorage (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω)`);
          console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (Telegram/Google Analytics)`);
          console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DOM –æ–ø–µ—Ä–∞—Ü–∏–∏ (–º–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—è)`);
          console.log(`üìä [–î–ï–ë–ê–ì–ì–ï–†] 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSS –∞–Ω–∏–º–∞—Ü–∏–∏ (–º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫)`);
        }
      }
    }

    // –°–æ–∑–¥–∞–µ–º –¥–µ–±–∞–≥–≥–µ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    const perfDebugger = new PerformanceDebugger();

    // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.perfDebugger = perfDebugger;

    // –ó–ê–ú–ï–ù–ê —Ñ—É–Ω–∫—Ü–∏–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –Ω–∞ –±—ã—Å—Ç—Ä—ã–µ –≤–µ—Ä—Å–∏–∏
    function trackEmotionSet(emotion, date) {
      console.log('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —ç–º–æ—Ü–∏—è:', emotion, '–Ω–∞ –¥–∞—Ç—É:', date);
      fastAnalytics.track('emotion_set_home', {
        emotion: emotion,
        date: date,
        source: 'home_calendar',
        user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'anonymous'
      });
    }

    function trackEmotionRemove(emotion, date) {
      console.log('–£–¥–∞–ª–µ–Ω–∞ —ç–º–æ—Ü–∏—è:', emotion, '—Å –¥–∞—Ç—ã:', date);
      fastAnalytics.track('emotion_remove_home', {
        emotion: emotion,
        date: date,
        source: 'home_calendar',
        user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'anonymous'
      });
    }

    function trackWeekNavigation(direction, weekOffset) {
      console.log('–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º:', direction, '–°–º–µ—â–µ–Ω–∏–µ:', weekOffset);
      fastAnalytics.track('week_navigation_home', {
        direction: direction,
        week_offset: weekOffset,
        source: 'home_calendar',
        user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'anonymous'
      });
    }

    // –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏)
    function testAnalytics() {
      console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º Telegram Analytics...');
      trackEvent('test_event', {
        test_parameter: 'test_value',
        user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'test_user'
      });
    }

    // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.testAnalytics = testAnalytics;
  </script>
  
  <style>
    :root {
      --main: #19191B;
      --white: #ffffff;
      --text-2: #b3b3b3;
      --green: #34A853;
      
      --emotion-joyful: #34A853;
      --emotion-good: #5CDE6D;
      --emotion-so-so: #FFD527;
      --emotion-anxious: #FF7DB0;
      --emotion-sad: #4285F4;
      --emotion-bad: #E74639;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: var(--main);
      font-family: "Inter", sans-serif;
    }

    h1, h2, h3, h4, h5, h6, p {
      margin: 0;
      padding: 0;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* Language Switcher - –∏–¥–µ–Ω—Ç–∏—á–Ω–æ practices.html */
    .language-switcher {
      position: fixed;
      top: 24px;
      right: calc(50vw - 163.5px);
      z-index: 200;
      display: flex;
      gap: 8px;
      background: rgba(255, 255, 255, 0.05);
      padding: 4px;
      border-radius: 8px;
      backdrop-filter: blur(10px);
    }

    /* –î–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 425px) {
      .language-switcher {
        right: 24px;
      }
    }

    .lang-btn {
      background: none;
      border: none;
      color: var(--text-2);
      font-size: 12px;
      font-weight: 500;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: "Inter", sans-serif;
    }

    .lang-btn.active {
      background: linear-gradient(135deg, #FFD527 8%, #34A853 85%, #4285F4 98%);
      color: white;
    }

    .lang-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .lang-btn.active:hover {
      background: linear-gradient(135deg, #FFD527 8%, #34A853 85%, #4285F4 98%);
    }

    /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .home {
      max-width: 375px;
      margin: 0 auto;
      padding: 96px 24px 24px 24px;
      display: flex;
      flex-direction: column;
      padding-bottom: 96px;
      box-sizing: border-box;
    }

    @supports (padding-bottom: env(safe-area-inset-bottom)) {
      .home {
        padding-bottom: calc(96px + env(safe-area-inset-bottom) + 20px);
      }
    }

    /* –•–µ–¥–µ—Ä —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º/–∞–≤–∞—Ç–∞—Ä–æ–º */
    .logo {
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      max-width: 375px;
      width: 100%;
      z-index: 100;
      background-color: var(--main);
      padding: 24px;
      box-sizing: border-box;
    }

    .logo img {
      height: 33px;
      width: auto;
      display: block;
    }

    .user-header {
      display: flex;
      align-items: center;
      gap: 16px;
      width: 100%;
      text-decoration: none;
      color: inherit;
      transition: opacity 0.2s;
    }

    .user-header:hover {
      opacity: 0.8;
    }

    .user-header:active {
      opacity: 0.6;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      overflow: hidden;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .avatar-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center center;
      display: block;
      border-radius: 50%;
    }

    .avatar-placeholder {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 600;
      color: var(--text-2);
    }

    .user-name {
      font-size: 18px;
      line-height: 24px;
      font-weight: 500;
      color: var(--white);
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–ª–æ–∫ */
    .header {
      max-width: 327px;
      width: 100%;
      margin: 0 auto 48px auto;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .text-welcome {
      font-size: 14px;
      line-height: 20px;
      font-weight: 400;
      color: var(--text-2);
    }

    .text-title {
      font-size: 24px;
      line-height: 32px;
      font-weight: 700;
      color: var(--white);
    }

    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å */
    .calendar-section {
      margin-bottom: 48px;
      position: relative;
      z-index: 1;
    }

    .compact-calendar {
      width: 100%;
      max-width: 327px;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 18px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .month-nav {
      background: none;
      border: none;
      color: var(--text-2);
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 16px;
      line-height: 1;
      min-width: 32px;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .month-nav:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }

    .month-nav:active {
      transform: scale(0.9);
    }

    .current-month {
      font-size: 16px;
      font-weight: 600;
      color: var(--white);
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 8px;
    }

    .calendar-weekday {
      text-align: center;
      font-size: 10px;
      font-weight: 500;
      color: var(--text-2);
      padding: 5px 0;
    }

    .calendar-days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      column-gap: 4px; /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ (–¥–Ω–∏ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ) */
      row-gap: 12px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏ */
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      font-weight: 400;
      color: var(--white);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s ease; /* –£—Å–∫–æ—Ä–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—é */
      position: relative;
      min-height: 32px;
      padding: 1px;
    }

    .calendar-day:hover {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 8px;
    }

    .calendar-day.empty {
      opacity: 0;
      cursor: default;
    }

    .calendar-day.empty:hover {
      background-color: transparent;
    }

    .calendar-day.today {
      border-radius: 8px;
    }

    .calendar-day.today.has-emotion {
      border-radius: 8px;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç–º–æ—Ü–∏–∏ –≤ –¥–Ω–µ "—Å–µ–≥–æ–¥–Ω—è" –ë–ï–ó —ç–º–æ—Ü–∏–∏ */
    .calendar-day.today:not(.has-emotion) .calendar-day-emotion {
      animation: emotionPulse 2s ease-in-out infinite;
    }

    /* –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∫–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal-open .calendar-day.today:not(.has-emotion) .calendar-day-emotion {
      animation: none;
    }

    @keyframes emotionPulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(52, 168, 83, 0.4);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 0 0 3px rgba(52, 168, 83, 0.2);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(52, 168, 83, 0);
      }
    }

    .calendar-day.future-date {
      opacity: 0.3;
      cursor: not-allowed;
      border-radius: 8px;
    }

    .calendar-day.future-date:hover {
      background-color: transparent;
      border-radius: 8px;
    }

    /* –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–Ω—è: —ç–º–æ—Ü–∏—è —Å–≤–µ—Ä—Ö—É, –¥–∞—Ç–∞ —Å–Ω–∏–∑—É - –£–í–ï–õ–ò–ß–ï–ù–´ —ç–º–æ—Ü–∏–∏ */
    .calendar-day-emotion {
      width: 28px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 22px –¥–æ 28px –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
      height: 28px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 22px –¥–æ 28px –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
      border-radius: 50%;
      margin-bottom: 6px; /* –£–≤–µ–ª–∏—á–µ–Ω–æ —Å 2px –¥–æ 6px –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –æ—Ç—Å—Ç—É–ø–∞ –æ—Ç —Ü–∏—Ñ—Ä—ã */
      flex-shrink: 0;
      align-self: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —ç–º–æ—Ü–∏—é */
    }

    .calendar-day-number {
      font-size: 10px;
      font-weight: 400;
      color: var(--white);
      line-height: 1;
    }

    /* –°–µ—Ä–∞—è —ç–º–æ—Ü–∏—è-–∑–∞–≥–ª—É—à–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è */
    .calendar-day-emotion {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23666666'/%3E%3Cpath d='M 15 25 L 25 25' stroke='%23333333' stroke-width='1.5' stroke-linecap='round'/%3E%3Ccircle cx='15' cy='17' r='1.5' fill='%23333333'/%3E%3Ccircle cx='25' cy='17' r='1.5' fill='%23333333'/%3E%3C/svg%3E");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* –¶–≤–µ—Ç–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ - –¢–û–ß–ù–û –°–ö–û–ü–ò–†–û–í–ê–ù–´ –∏–∑ journal.html —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–æ–ª—â–∏–Ω—ã –ª–∏–Ω–∏–π */
    .calendar-day.emotion-joyful .calendar-day-emotion { 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%2334A853'/%3E%3Cpath d='M 12 15 Q 15 18 18 15' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 22 15 Q 25 18 28 15' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 12 25 Q 20 32 28 25' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3Ccircle cx='30' cy='15' r='1' fill='%23FFD527'/%3E%3C/svg%3E");
    }
    
    .calendar-day.emotion-good .calendar-day-emotion { 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%235CDE6D'/%3E%3Ccircle cx='15' cy='17' r='2' fill='%2319191B'/%3E%3Ccircle cx='25' cy='17' r='2' fill='%2319191B'/%3E%3Cpath d='M 15 25 Q 20 28 25 25' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3Ccircle cx='10' cy='23' r='3' fill='%23FFB3D1' opacity='0.4'/%3E%3Ccircle cx='30' cy='23' r='3' fill='%23FFB3D1' opacity='0.4'/%3E%3C/svg%3E");
    }
    
    .calendar-day.emotion-so-so .calendar-day-emotion { 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23FFD527'/%3E%3Cpath d='M 13 17 L 17 17' stroke='%2319191B' stroke-width='1.7' stroke-linecap='round'/%3E%3Cpath d='M 23 17 L 27 17' stroke='%2319191B' stroke-width='1.7' stroke-linecap='round'/%3E%3Cpath d='M 15 25 Q 20 23 25 25' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    }
    
    .calendar-day.emotion-anxious .calendar-day-emotion { 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23FF7DB0'/%3E%3Cellipse cx='15' cy='17' rx='1.5' ry='3' fill='%2319191B'/%3E%3Cellipse cx='25' cy='17' rx='1.5' ry='3' fill='%2319191B'/%3E%3Cellipse cx='20' cy='25' rx='4' ry='2' fill='%2319191B'/%3E%3C/svg%3E");
    }
    
    .calendar-day.emotion-sad .calendar-day-emotion { 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%234285F4'/%3E%3Cpath d='M 12 15 Q 15 18 18 15' stroke='%2319191B' stroke-width='1.3' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 22 15 Q 25 18 28 15' stroke='%2319191B' stroke-width='1.3' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 15 28 Q 20 23 25 28' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3Cellipse cx='12' cy='22' rx='1' ry='3' fill='%234285F4'/%3E%3Cellipse cx='28' cy='22' rx='1' ry='3' fill='%234285F4'/%3E%3C/svg%3E");
    }
    
    .calendar-day.emotion-bad .calendar-day-emotion { 
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23E74639'/%3E%3Cpath d='M 10 13 L 16 16' stroke='%2319191B' stroke-width='1.7' stroke-linecap='round'/%3E%3Cpath d='M 24 16 L 30 13' stroke='%2319191B' stroke-width='1.7' stroke-linecap='round'/%3E%3Ccircle cx='15' cy='18' r='1.5' fill='%2319191B'/%3E%3Ccircle cx='25' cy='18' r='1.5' fill='%2319191B'/%3E%3Cpath d='M 15 28 Q 20 23 25 28' stroke='%2319191B' stroke-width='1.7' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–º–æ—Ü–∏–π */
    .emotion-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(8px);
      transition: opacity 0.2s ease; /* –ë—ã—Å—Ç—Ä–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è */
    }

    .emotion-modal.active {
      display: flex;
    }

    .emotion-picker {
      background-color: var(--main);
      border-radius: 16px;
      padding: 24px 20px 20px 20px;
      max-width: 280px;
      width: 85%;
      border: 1px solid rgba(255, 255, 255, 0.15);
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    }

    .emotion-picker-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .emotion-picker-date {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .emotion-picker-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--white);
      line-height: 1.2;
      margin: 0;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--text-2);
      cursor: pointer;
      padding: 8px;
      margin: -8px -8px -8px 8px;
      border-radius: 8px;
      transition: all 0.2s;
      font-size: 18px;
      line-height: 1;
      min-width: 32px;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .close-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }

    .emotions-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 0;
    }

    .emotion-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      padding: 16px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s ease; /* –ë—ã—Å—Ç—Ä–∞—è –∞–Ω–∏–º–∞—Ü–∏—è */
      border: 2px solid transparent;
      background-color: rgba(255, 255, 255, 0.03);
    }

    .emotion-option:hover {
      background-color: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .emotion-option:active {
      transform: translateY(0);
    }

    /* –≠–º–æ—Ü–∏–∏-–ª–∏—Ü–∞ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ - –¢–û–ß–ù–û –°–ö–û–ü–ò–†–û–í–ê–ù–´ –∏–∑ journal.html */
    .emotion-color {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      flex-shrink: 0;
      transition: all 0.15s ease; /* –£—Å–∫–æ—Ä–∏–ª–∏ –∞–Ω–∏–º–∞—Ü–∏—é */
    }

    .emotion-option[data-emotion="joyful"] .emotion-color {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%2334A853'/%3E%3Cpath d='M 12 15 Q 15 18 18 15' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 22 15 Q 25 18 28 15' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 12 25 Q 20 32 28 25' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3Ccircle cx='30' cy='15' r='1' fill='%23FFD527'/%3E%3C/svg%3E");
      background-size: cover;
    }

    .emotion-option[data-emotion="good"] .emotion-color {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%235CDE6D'/%3E%3Ccircle cx='15' cy='17' r='2' fill='%2319191B'/%3E%3Ccircle cx='25' cy='17' r='2' fill='%2319191B'/%3E%3Cpath d='M 15 25 Q 20 28 25 25' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3Ccircle cx='10' cy='23' r='3' fill='%23FFB3D1' opacity='0.4'/%3E%3Ccircle cx='30' cy='23' r='3' fill='%23FFB3D1' opacity='0.4'/%3E%3C/svg%3E");
      background-size: cover;
    }

    .emotion-option[data-emotion="so-so"] .emotion-color {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23FFD527'/%3E%3Cpath d='M 13 17 L 17 17' stroke='%2319191B' stroke-width='2' stroke-linecap='round'/%3E%3Cpath d='M 23 17 L 27 17' stroke='%2319191B' stroke-width='2' stroke-linecap='round'/%3E%3Cpath d='M 15 25 Q 20 23 25 25' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-size: cover;
    }

    .emotion-option[data-emotion="anxious"] .emotion-color {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23FF7DB0'/%3E%3Cellipse cx='15' cy='17' rx='1.5' ry='3' fill='%2319191B'/%3E%3Cellipse cx='25' cy='17' rx='1.5' ry='3' fill='%2319191B'/%3E%3Cellipse cx='20' cy='25' rx='4' ry='2' fill='%2319191B'/%3E%3C/svg%3E");
      background-size: cover;
    }

    .emotion-option[data-emotion="sad"] .emotion-color {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%234285F4'/%3E%3Cpath d='M 12 15 Q 15 18 18 15' stroke='%2319191B' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 22 15 Q 25 18 28 15' stroke='%2319191B' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3Cpath d='M 15 28 Q 20 23 25 28' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3Cellipse cx='12' cy='22' rx='1' ry='3' fill='%234285F4'/%3E%3Cellipse cx='28' cy='22' rx='1' ry='3' fill='%234285F4'/%3E%3C/svg%3E");
      background-size: cover;
    }

    .emotion-option[data-emotion="bad"] .emotion-color {
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23E74639'/%3E%3Cpath d='M 10 13 L 16 16' stroke='%2319191B' stroke-width='2' stroke-linecap='round'/%3E%3Cpath d='M 24 16 L 30 13' stroke='%2319191B' stroke-width='2' stroke-linecap='round'/%3E%3Ccircle cx='15' cy='18' r='1.5' fill='%2319191B'/%3E%3Ccircle cx='25' cy='18' r='1.5' fill='%2319191B'/%3E%3Cpath d='M 15 28 Q 20 23 25 28' stroke='%2319191B' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-size: cover;
    }

    .emotion-option:hover .emotion-color {
      transform: scale(1.1);
    }

    .emotion-name {
      font-size: 12px;
      font-weight: 500;
      color: var(--white);
      text-align: center;
    }

    /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
    .cards {
      display: flex;
      flex-direction: column;
      gap: 24px;
      margin-bottom: 52px;
      position: relative;
      z-index: 1;
    }

    .card {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      width: 100%;
      max-width: 327px;
      height: 80px;
      margin: 0 auto;
      box-sizing: border-box;
      padding-right: 16px;
      transition: background-color 0.2s;
    }

    .card:active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .card img:first-child {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 8px 0 0 8px;
      flex-shrink: 0;
    }

    .card-content {
      display: flex;
      flex-direction: column;
      justify-content: center;
      flex: 1;
      margin-left: 24px;
      gap: 0px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      line-height: 24px;
      color: var(--white);
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-2);
      line-height: 16px;
    }

    .card .arrow {
      width: 5px;
      height: 10px;
      margin-left: 16px;
    }



    /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 375px;
      background-color: var(--main);
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 1000;
      
      padding-bottom: calc(12px + env(safe-area-inset-bottom));
      padding-bottom: calc(12px + 20px);
      padding-bottom: calc(12px + env(safe-area-inset-bottom, 20px));
    }

    .tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 12px;
      line-height: 18px;
      font-weight: 400;
      color: var(--text-2);
      gap: 8px;
    }

    .tab.active {
      font-weight: 600;
      color: var(--green);
    }

    .tab.active img {
      filter: brightness(1.5);
    }

    .tab img {
      width: 24px;
      height: 24px;
      transition: transform 0.1s, filter 0.1s;
    }

    .tab img:active {
      transform: scale(0.9);
      filter: brightness(1.5);
    }
  </style>
</head>
<body>
  <!-- Language Switcher -->
  <div class="language-switcher">
    <button class="lang-btn active" id="enBtn">EN</button>
    <button class="lang-btn" id="ruBtn">RU</button>
  </div>

  <div class="home">
    <!-- –õ–æ–≥–æ—Ç–∏–ø –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –∞–≤–∞—Ç–∞—Ä –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ JavaScript -->
    <div class="logo" id="headerLogo">
      <img src="img/logo.svg" alt="Potok logo">
    </div>

    <div class="header">
      <div class="text-welcome" data-translate="welcome">Welcome!</div>
      <div class="text-title" data-translate="feeling_question">How are you feeling?</div>
    </div>

    <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div class="calendar-section">
      <div class="compact-calendar">
        <div class="calendar-header">
          <button class="month-nav" id="prevMonth">‚Äπ</button>
          <div class="current-month" id="currentMonth">June 2025</div>
          <button class="month-nav" id="nextMonth">‚Ä∫</button>
        </div>

        <div class="calendar-weekdays">
          <div class="calendar-weekday" data-translate="monday_short">Mon</div>
          <div class="calendar-weekday" data-translate="tuesday_short">Tue</div>
          <div class="calendar-weekday" data-translate="wednesday_short">Wed</div>
          <div class="calendar-weekday" data-translate="thursday_short">Thu</div>
          <div class="calendar-weekday" data-translate="friday_short">Fri</div>
          <div class="calendar-weekday" data-translate="saturday_short">Sat</div>
          <div class="calendar-weekday" data-translate="sunday_short">Sun</div>
        </div>

        <div class="calendar-days-grid" id="calendarDaysGrid">
          <!-- –î–Ω–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
      </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div class="cards">
      <a href="pause.html" class="card">
        <img src="img/mind.jpg" alt="Calm thoughts">
        <div class="card-content">
          <div class="card-title" data-translate="calm_thoughts">Calm thoughts</div>
          <div class="card-subtitle" data-translate="meditation_duration">Meditation</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
      <a href="478.html" class="card">
        <img src="img/breathing.jpg" alt="Reduce stress">
        <div class="card-content">
          <div class="card-title" data-translate="reduce_stress">Reduce stress</div>
          <div class="card-subtitle" data-translate="breathing_duration">Breathing</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
      <a href="stars.html" class="card">
        <img src="img/sleep.jpg" alt="Improve sleep">
        <div class="card-content">
          <div class="card-title" data-translate="improve_sleep">Improve sleep</div>
          <div class="card-subtitle" data-translate="sleep_duration">Sleep</div>
        </div>
        <img class="arrow" src="img/arrow.svg" alt="arrow">
      </a>
    </div>


  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —ç–º–æ—Ü–∏–π -->
  <div class="emotion-modal" id="emotionModal">
    <div class="emotion-picker">
      <div class="emotion-picker-header">
        <div>
          <div class="emotion-picker-date" id="selectedDateText">MONDAY, JUNE 30, 2025</div>
        </div>
        <button class="close-button" id="closeModal">‚úï</button>
      </div>
      
      <div class="emotions-grid">
        <div class="emotion-option" data-emotion="joyful">
          <div class="emotion-color"></div>
          <div class="emotion-name" data-translate="emotion_joyful">Joyful</div>
        </div>
        <div class="emotion-option" data-emotion="good">
          <div class="emotion-color"></div>
          <div class="emotion-name" data-translate="emotion_good">Good</div>
        </div>
        <div class="emotion-option" data-emotion="so-so">
          <div class="emotion-color"></div>
          <div class="emotion-name" data-translate="emotion_so_so">So-so</div>
        </div>
        <div class="emotion-option" data-emotion="anxious">
          <div class="emotion-color"></div>
          <div class="emotion-name" data-translate="emotion_anxious">Anxious</div>
        </div>
        <div class="emotion-option" data-emotion="sad">
          <div class="emotion-color"></div>
          <div class="emotion-name" data-translate="emotion_sad">Sad</div>
        </div>
        <div class="emotion-option" data-emotion="bad">
          <div class="emotion-color"></div>
          <div class="emotion-name" data-translate="emotion_bad">Bad</div>
        </div>
      </div>
    </div>
  </div>

  <footer class="tab-bar">
    <a href="index.html" class="tab active">
      <img src="img/home-active.svg" alt="Today">
      <div data-translate="today">Today</div>
    </a>
    <a href="practices.html" class="tab">
      <img src="img/practices.svg" alt="Practices">
      <div data-translate="practices">Practices</div>
    </a>
    <a href="journal.html" class="tab">
      <img src="img/journal.svg" alt="Journal">
      <div data-translate="journal">Calendar</div>
    </a>
  </footer>

  <script>
    // Google Sheets Service (–∑–∞–º–µ–Ω—è–µ—Ç Firebase)
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwn9DI7NzYn_e5B35OQXSl1q5IbRMJ2I0egBD6ygi4cbroyZlqZXhB0JcG5cZ3yIfIX/exec';
    // –ü–µ—Ä–µ–≤–æ–¥—ã —Å –ù–û–í–´–ú–ò –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
    const translations = {
      en: {
        page_title: "Potok ‚Äî Home",
        welcome: "Welcome!",
        feeling_question: "How are you feeling?",
        calm_thoughts: "Calm thoughts",
        reduce_stress: "Reduce stress", 
        improve_sleep: "Improve sleep",
        meditation_duration: "Meditation",
        breathing_duration: "Breathing",
        sleep_duration: "Sleep",
        today: "Today",
        practices: "Practices",
        journal: "Game",
        how_feeling: "How are you feeling?",
        emotion_joyful: "Joyful",
        emotion_good: "Good",
        emotion_so_so: "So-so",
        emotion_anxious: "Anxious", 
        emotion_sad: "Sad",
        emotion_bad: "Bad",
        // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ
        monday_short: "Mon",
        tuesday_short: "Tue",
        wednesday_short: "Wed",
        thursday_short: "Thu",
        friday_short: "Fri",
        saturday_short: "Sat",
        sunday_short: "Sun",
        // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –¥–ª—è –¥–∞—Ç—ã
        sunday_full: "SUNDAY",
        monday_full: "MONDAY",
        tuesday_full: "TUESDAY", 
        wednesday_full: "WEDNESDAY",
        thursday_full: "THURSDAY",
        friday_full: "FRIDAY",
        saturday_full: "SATURDAY",
        // –ú–µ—Å—è—Ü—ã
        january: "January",
        february: "February",
        march: "March",
        april: "April",
        may: "May",
        june: "June",
        july: "July",
        august: "August",
        september: "September",
        october: "October",
        november: "November",
        december: "December"
      },
      ru: {
        page_title: "–ü–æ—Ç–æk ‚Äî –ì–ª–∞–≤–Ω–∞—è",
        welcome: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
        feeling_question: "–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?",
        calm_thoughts: "–£—Å–ø–æ–∫–æ–∏—Ç—å –º—ã—Å–ª–∏",
        reduce_stress: "–°–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å",
        improve_sleep: "–£–ª—É—á—à–∏—Ç—å —Å–æ–Ω", 
        meditation_duration: "–ú–µ–¥–∏—Ç–∞—Ü–∏—è",
        breathing_duration: "–î—ã—Ö–∞–Ω–∏–µ",
        sleep_duration: "–°–æ–Ω",
        today: "–°–µ–≥–æ–¥–Ω—è",
        practices: "–ü—Ä–∞–∫—Ç–∏–∫–∏", 
        journal: "–ò–≥—Ä–∞",
        how_feeling: "–ö–∞–∫ —Ç—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—à—å?",
        emotion_joyful: "–†–∞–¥–æ—Å—Ç–Ω–æ",
        emotion_good: "–•–æ—Ä–æ—à–æ", 
        emotion_so_so: "–¢–∞–∫ —Å–µ–±–µ",
        emotion_anxious: "–¢—Ä–µ–≤–æ–∂–Ω–æ",
        emotion_sad: "–ì—Ä—É—Å—Ç–Ω–æ",
        emotion_bad: "–ü–ª–æ—Ö–æ",
        // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ
        monday_short: "–ü–Ω",
        tuesday_short: "–í—Ç",
        wednesday_short: "–°—Ä",
        thursday_short: "–ß—Ç",
        friday_short: "–ü—Ç",
        saturday_short: "–°–±",
        sunday_short: "–í—Å",
        // –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –¥–ª—è –¥–∞—Ç—ã
        sunday_full: "–í–û–°–ö–†–ï–°–ï–ù–¨–ï",
        monday_full: "–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö", 
        tuesday_full: "–í–¢–û–†–ù–ò–ö",
        wednesday_full: "–°–†–ï–î–ê",
        thursday_full: "–ß–ï–¢–í–ï–†–ì",
        friday_full: "–ü–Ø–¢–ù–ò–¶–ê",
        saturday_full: "–°–£–ë–ë–û–¢–ê",
        // –ú–µ—Å—è—Ü—ã
        january: "–Ø–Ω–≤–∞—Ä—å",
        february: "–§–µ–≤—Ä–∞–ª—å",
        march: "–ú–∞—Ä—Ç",
        april: "–ê–ø—Ä–µ–ª—å",
        may: "–ú–∞–π",
        june: "–ò—é–Ω—å",
        july: "–ò—é–ª—å",
        august: "–ê–≤–≥—É—Å—Ç",
        september: "–°–µ–Ω—Ç—è–±—Ä—å",
        october: "–û–∫—Ç—è–±—Ä—å",
        november: "–ù–æ—è–±—Ä—å",
        december: "–î–µ–∫–∞–±—Ä—å"
      }
    };

    // DateUtils –∫–ª–∞—Å—Å –∏–∑ journal.html
    class DateUtils {
      static getUserTimezone() {
        try {
          return Intl.DateTimeFormat().resolvedOptions().timeZone;
        } catch (error) {
          console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å:', error);
          return 'UTC';
        }
      }

      static getCurrentDateInUserTimezone() {
        const timezone = this.getUserTimezone();
        console.log(`üåç –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${timezone}`);
        
        try {
          const now = new Date();
          const userDate = new Date(now.toLocaleString("en-US", {timeZone: timezone}));
          console.log(`üìÖ –¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userDate.toDateString()}`);
          return userDate;
        } catch (error) {
          console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —á–∞—Å–æ–≤—ã–º –ø–æ—è—Å–æ–º, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:', error);
          return new Date();
        }
      }

      static isTodayInUserTimezone(date) {
        const today = this.getCurrentDateInUserTimezone();
        return date.getFullYear() === today.getFullYear() &&
               date.getMonth() === today.getMonth() &&
               date.getDate() === today.getDate();
      }
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô Google Sheets Service - —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –æ–±–Ω—É–ª–µ–Ω–∏—è —ç–º–æ—Ü–∏–π
    class GoogleSheetsService {
      constructor() {
        this.isOnline = false;
        this.userId = null;
        this.isInitialized = false;
        this.isGoogleSheetsReady = false;
        this.userTimezone = null;
        this.chatId = null;
        
        this.STORAGE_KEYS = {
          USER_ID: 'potok_stable_user_id',
          EMOTIONS: 'potok_emotions_data',
          LAST_SYNC: 'potok_last_sync',
          TIMEZONE: 'potok_user_timezone',
          CHAT_ID: 'potok_chat_id',
          NOTIFICATION_REGISTERED: 'potok_notification_registered'
        };
        
        this.userId = this.generateStableUserId();
        this.userTimezone = this.determineUserTimezone();
        this.chatId = this.determineChatId();
        this.isInitialized = true;
        this.initGoogleSheetsInBackground();
      }

      generateStableUserId() {
        if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp?.initDataUnsafe?.user?.id) {
          const telegramId = `tg_${window.Telegram.WebApp.initDataUnsafe.user.id}`;
          console.log('üéØ –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram ID:', telegramId);
          return telegramId;
        }

        try {
          const savedId = localStorage.getItem(this.STORAGE_KEYS.USER_ID);
          if (savedId) {
            console.log('üíæ –ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π ID:', savedId);
            return savedId;
          }
        } catch (error) {
          console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage:', error);
        }

        const newId = `stable_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        
        try {
          localStorage.setItem(this.STORAGE_KEYS.USER_ID, newId);
          console.log('üÜï –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π ID:', newId);
        } catch (error) {
          console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ID –≤ localStorage');
        }
        
        return newId;
      }

      determineUserTimezone() {
        try {
          // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ localStorage
          const savedTimezone = localStorage.getItem(this.STORAGE_KEYS.TIMEZONE);
          if (savedTimezone) {
            console.log('üíæ –ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å:', savedTimezone);
            return savedTimezone;
          }
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
          const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
          console.log('üåç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å:', timezone);
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
          try {
            localStorage.setItem(this.STORAGE_KEYS.TIMEZONE, timezone);
          } catch (error) {
            console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å timezone –≤ localStorage');
          }
          
          return timezone;
        } catch (error) {
          console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞:', error);
          return 'UTC'; // Fallback
        }
      }

      determineChatId() {
        try {
          // –î–ª—è Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π chat_id = user_id (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ tg_)
          if (typeof window.Telegram !== 'undefined' && window.Telegram.WebApp?.initDataUnsafe?.user?.id) {
            const chatId = window.Telegram.WebApp.initDataUnsafe.user.id.toString();
            console.log('üì± Telegram chat_id:', chatId);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            try {
              localStorage.setItem(this.STORAGE_KEYS.CHAT_ID, chatId);
            } catch (error) {
              console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å chat_id –≤ localStorage');
            }
            
            return chatId;
          }
          
          // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ localStorage –¥–ª—è –≤–µ–±-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
          const savedChatId = localStorage.getItem(this.STORAGE_KEYS.CHAT_ID);
          if (savedChatId) {
            console.log('üíæ –ù–∞–π–¥–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π chat_id:', savedChatId);
            return savedChatId;
          }
          
          console.log('‚ö†Ô∏è Chat ID –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–≤–µ–±-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)');
          return null;
        } catch (error) {
          console.log('‚ùå –û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è chat_id:', error);
          return null;
        }
      }

      async initGoogleSheetsInBackground() {
        try {
          console.log('üìä –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google Sheets –≤ —Ñ–æ–Ω–µ...');
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
          this.setupConnectionListener();
          
          this.isOnline = navigator.onLine;
          this.isGoogleSheetsReady = true;
          console.log('‚úÖ Google Sheets —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–æ–Ω–µ');
          
          // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
          await this.registerUserForNotifications();
          
          // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
          if (window.compactCalendar) {
            await window.compactCalendar.syncWithGoogleSheets();
          }
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Google Sheets:', error);
          this.isOnline = false;
          this.isGoogleSheetsReady = false;
        }
      }

      async registerUserForNotifications() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –ª–∏ —É–∂–µ —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        try {
          const alreadyRegistered = localStorage.getItem(this.STORAGE_KEYS.NOTIFICATION_REGISTERED);
          const lastRegistration = alreadyRegistered ? new Date(alreadyRegistered) : null;
          const now = new Date();
          
          // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∑–∞–Ω–æ–≤–æ, –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 24 —á–∞—Å–æ–≤ –∏–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Ä–∞–∑
          if (!lastRegistration || (now - lastRegistration) > 24 * 60 * 60 * 1000) {
            console.log('üîî –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...');
            
            if (this.chatId) {
              // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º chat_id
              await this.registerChatId();
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            await this.saveNotificationSettings(true); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–∫–ª—é—á–µ–Ω—ã
            
            // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
            try {
              localStorage.setItem(this.STORAGE_KEYS.NOTIFICATION_REGISTERED, now.toISOString());
            } catch (error) {
              console.log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–ª–∞–≥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏');
            }
            
            console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
          } else {
            console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
          }
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', error);
        }
      }

      async registerChatId() {
        if (!this.isOnline || !this.isGoogleSheetsReady || !this.chatId) {
          console.log('üö´ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å chat_id');
          return;
        }

        try {
          console.log(`üì± –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º chat_id: ${this.chatId} –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${this.userId}`);
          
          const params = new URLSearchParams({
            action: 'register-chat-id',
            user_id: this.userId,
            chat_id: this.chatId
          });

          const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
          
          const response = await fetch(url, { method: 'GET' });
          const result = await response.text();
          
          if (result.includes('SUCCESS')) {
            console.log('‚úÖ Chat ID —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω');
          } else {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ chat_id:', result);
          }
        } catch (error) {
          console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ chat_id:', error);
        }
      }

      async saveNotificationSettings(enabled) {
        if (!this.isOnline || !this.isGoogleSheetsReady) {
          console.log('üö´ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
          return;
        }

        try {
          console.log(`üîî –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: enabled=${enabled}, timezone=${this.userTimezone}`);
          
          const params = new URLSearchParams({
            action: 'save-notification-settings',
            user_id: this.userId,
            notification_enabled: enabled.toString(),
            timezone: this.userTimezone,
            chat_id: this.chatId || ''
          });

          const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
          
          const response = await fetch(url, { method: 'GET' });
          const result = await response.text();
          
          if (result.includes('SUCCESS')) {
            console.log('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
          } else {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:', result);
          }
        } catch (error) {
          console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫:', error);
        }
      }

      setupConnectionListener() {
        window.addEventListener('online', () => {
          console.log('üåê –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω');
          this.isOnline = true;
        });

        window.addEventListener('offline', () => {
          console.log('üìµ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω');
          this.isOnline = false;
        });
      }

      // –ù–ê–ô–î–ò–¢–ï –∏ –ó–ê–ú–ï–ù–ò–¢–ï —ç—Ç–æ—Ç –º–µ—Ç–æ–¥:
loadEmotionsInstantly() {
  console.log('‚ö° –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –∑–∞–≥—Ä—É–∑–∫–∞ —ç–º–æ—Ü–∏–π...');
  let emotions = {};
  
  try {
    const localData = localStorage.getItem(this.STORAGE_KEYS.EMOTIONS);
    if (localData) {
      emotions = JSON.parse(localData);
      const count = Object.keys(emotions).length;
      console.log(`üíæ –≠–º–æ—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ localStorage: ${count}`);
      return emotions;
    } else {
      console.log('üíæ localStorage –ø—É—Å—Ç–æ–π - –≤–æ–∑–º–æ–∂–Ω–æ –∫—ç—à –æ—á–∏—â–µ–Ω');
      console.log('üîÑ –ë—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑ Google Sheets...');
      return {}; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç
    }
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage:', error);
    return {};
  }
}
      // –î–û–ë–ê–í–¨–¢–ï —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ü–û–°–õ–ï loadEmotionsInstantly:
async loadFromGoogleSheetsSync() {
  if (!this.isOnline) {
    console.log('üö´ –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ - –Ω–µ –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ Google Sheets');
    return {};
  }
  
  try {
    console.log('üìä –ù–ï–ú–ï–î–õ–ï–ù–ù–ê–Ø –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Google Sheets (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞)...');
    
    const url = `${GOOGLE_SCRIPT_URL}?action=get-emotions&user_id=${encodeURIComponent(this.userId)}`;
    const response = await fetch(url, { method: 'GET' });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const responseText = await response.text();
    console.log('üìä –û—Ç–≤–µ—Ç –æ—Ç Google Sheets –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏:', responseText);
    
    if (responseText && responseText.trim() !== '') {
      const googleSheetsEmotions = JSON.parse(responseText);
      console.log('üìä –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏:', googleSheetsEmotions);
      
      if (googleSheetsEmotions && Object.keys(googleSheetsEmotions).length > 0) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        this.saveAllToLocalStorage(googleSheetsEmotions);
        console.log(`‚úÖ –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û ${Object.keys(googleSheetsEmotions).length} —ç–º–æ—Ü–∏–π –∏–∑ Google Sheets`);
        
        return googleSheetsEmotions;
      }
    }
    
    console.log('üìä Google Sheets –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
    return {};
    
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ Google Sheets:', error);
    return {};
  }
}

      // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –º–µ—Ç–æ–¥ syncWithGoogleSheets - –ù–ï –û–ë–ù–£–õ–Ø–ï–¢ –î–ê–ù–ù–´–ï
      async syncWithGoogleSheets() {
        if (!this.isGoogleSheetsReady || !this.isOnline) {
          console.log('üö´ Google Sheets –Ω–µ –≥–æ—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
          return this.loadEmotionsInstantly(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
        }

        console.log('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets...');
        
        try {
          // GET –∑–∞–ø—Ä–æ—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          const url = `${GOOGLE_SCRIPT_URL}?action=get-emotions&user_id=${encodeURIComponent(this.userId)}`;
          const response = await fetch(url, {
            method: 'GET'
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const responseText = await response.text();
          console.log('üìä –û—Ç–≤–µ—Ç –æ—Ç Google Sheets (raw):', responseText);
          
          let googleSheetsEmotions = {};
          
          try {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–∞—Ä—Å–∏—Ç—å –æ—Ç–≤–µ—Ç
            if (responseText && responseText.trim() !== '') {
              googleSheetsEmotions = JSON.parse(responseText);
              console.log('üìä –†–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–∏ –∏–∑ Google Sheets:', googleSheetsEmotions);
              
              // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã–µ
              if (googleSheetsEmotions && Object.keys(googleSheetsEmotions).length > 0) {
                // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏
                const existingEmotions = this.loadEmotionsInstantly();
                const mergedEmotions = { ...existingEmotions, ...googleSheetsEmotions };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                const hasChanges = JSON.stringify(existingEmotions) !== JSON.stringify(mergedEmotions);
                if (hasChanges) {
                  this.saveAllToLocalStorage(mergedEmotions);
                  console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã:', Object.keys(mergedEmotions).length);
                } else {
                  console.log('‚ÑπÔ∏è –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                }
                
                try {
                  localStorage.setItem(this.STORAGE_KEYS.LAST_SYNC, new Date().toISOString());
                } catch (e) {}
                
                return mergedEmotions;
              } else {
                console.log('üìä Google Sheets –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ - –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º localStorage');
                return this.loadEmotionsInstantly(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
              }
            } else {
              console.log('üìä –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç Google Sheets - –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º localStorage');
              return this.loadEmotionsInstantly(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            }
          } catch (parseError) {
            console.log('üìä –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Google Sheets:', parseError);
            console.log('üìä –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage');
            return this.loadEmotionsInstantly(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
          }
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets:', error);
          return this.loadEmotionsInstantly(); // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        }
      }

      // ‚ö° –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ë–ï–ó –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
      saveEmotionAsync(dateKey, emotion) {
        console.log(`‚ö° –ê–°–ò–ù–•–†–û–ù–ù–û–ï —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏: ${emotion} –¥–ª—è –¥–∞—Ç—ã: ${dateKey}`);
        
        // 1. –ú–ì–ù–û–í–ï–ù–ù–û —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        this.saveToLocalStorage(dateKey, emotion);
        console.log('‚úÖ –≠–º–æ—Ü–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage');

        // 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Google Sheets –ë–ï–ó –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
        if (this.isOnline && this.isGoogleSheetsReady) {
          const params = new URLSearchParams({
            action: 'save-emotion',
            user_id: this.userId,
            date_key: dateKey,
            emotion: emotion,
            user_name: this.getUserName(),
            platform: this.getPlatform(),
            emotion_action: 'set'
          });

          const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
          
          // –§–æ–Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ë–ï–ó await - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI!
          fetch(url, { method: 'GET' })
            .then(response => response.text())
            .then(result => {
              if (result.includes('SUCCESS')) {
                console.log('‚úÖ –≠–º–æ—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å Google Sheets:', dateKey, emotion);
                try {
                  localStorage.setItem(this.STORAGE_KEYS.LAST_SYNC, new Date().toISOString());
                } catch (e) {}
              } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets:', result);
              }
            })
            .catch(error => {
              console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error);
            });
        } else {
          console.log('üíæ –≠–º–æ—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ localStorage (–æ—Ñ–ª–∞–π–Ω)');
        }
      }

      deleteEmotionAsync(dateKey) {
        console.log(`‚ö° –ê–°–ò–ù–•–†–û–ù–ù–û–ï —É–¥–∞–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏ –¥–ª—è –¥–∞—Ç—ã: ${dateKey}`);
        
        // 1. –ú–ì–ù–û–í–ï–ù–ù–û —É–¥–∞–ª—è–µ–º –∏–∑ localStorage
        this.removeFromLocalStorage(dateKey);
        console.log('‚úÖ –≠–º–æ—Ü–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ localStorage');

        // 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —É–¥–∞–ª—è–µ–º –∏–∑ Google Sheets –ë–ï–ó –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
        if (this.isOnline && this.isGoogleSheetsReady) {
          const params = new URLSearchParams({
            action: 'save-emotion',
            user_id: this.userId,
            date_key: dateKey,
            emotion: '',
            user_name: this.getUserName(),
            platform: this.getPlatform(),
            emotion_action: 'remove'
          });

          const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
          
          // –§–æ–Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –ë–ï–ó await - –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI!
          fetch(url, { method: 'GET' })
            .then(response => response.text())
            .then(result => {
              if (result.includes('SUCCESS')) {
                console.log('‚úÖ –≠–º–æ—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ –∏–∑ Google Sheets:', dateKey);
              } else {
                console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ Google Sheets:', result);
              }
            })
            .catch(error => {
              console.error('‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', error);
            });
        } else {
          console.log('üíæ –≠–º–æ—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –∏–∑ localStorage (–æ—Ñ–ª–∞–π–Ω)');
        }
      }

      // –°–¢–ê–†–´–ï –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã - –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤ setEmotion
      async saveEmotion(dateKey, emotion) {
        console.log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏: ${emotion} –¥–ª—è –¥–∞—Ç—ã: ${dateKey}`);
        
        // –°–Ω–∞—á–∞–ª–∞ –í–°–ï–ì–î–ê –∏ –ú–ì–ù–û–í–ï–ù–ù–û —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
        this.saveToLocalStorage(dateKey, emotion);
        console.log('‚úÖ –≠–º–æ—Ü–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ localStorage');

        // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Google Sheets –≤ —Ñ–æ–Ω–µ
        if (this.isOnline && this.isGoogleSheetsReady) {
          try {
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞–∫ GET –∑–∞–ø—Ä–æ—Å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
            const params = new URLSearchParams({
              action: 'save-emotion',
              user_id: this.userId,
              date_key: dateKey,  // –ò–°–ü–†–ê–í–õ–ï–ù–û: date_key –≤–º–µ—Å—Ç–æ date
              emotion: emotion,
              user_name: this.getUserName(),
              platform: this.getPlatform(),
              emotion_action: 'set'
            });

            const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
            console.log('üìä –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å:', url);
            
            const response = await fetch(url, {
              method: 'GET'  // –ò–°–ü–†–ê–í–õ–ï–ù–û: GET –≤–º–µ—Å—Ç–æ POST
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.text();
            console.log('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç Google Sheets –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏:', result);
            
            if (result.includes('SUCCESS')) {
              console.log('‚úÖ –≠–º–æ—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ Google Sheets:', dateKey, emotion);
              
              try {
                localStorage.setItem(this.STORAGE_KEYS.LAST_SYNC, new Date().toISOString());
              } catch (e) {}
              
              return true;
            } else {
              throw new Error(result || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
            }
            
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Google Sheets:', error);
            return false;
          }
        } else {
          console.log('üíæ –≠–º–æ—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ localStorage (–æ—Ñ–ª–∞–π–Ω):', dateKey, emotion);
          return true;
        }
      }

      async deleteEmotion(dateKey) {
        console.log(`üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–∏ –¥–ª—è –¥–∞—Ç—ã: ${dateKey}`);
        
        // –°–Ω–∞—á–∞–ª–∞ –í–°–ï–ì–î–ê –∏ –ú–ì–ù–û–í–ï–ù–ù–û —É–¥–∞–ª—è–µ–º –∏–∑ localStorage
        this.removeFromLocalStorage(dateKey);
        console.log('‚úÖ –≠–º–æ—Ü–∏—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ localStorage');

        // –ó–∞—Ç–µ–º –ø—ã—Ç–∞–µ–º—Å—è —É–¥–∞–ª–∏—Ç—å –∏–∑ Google Sheets –≤ —Ñ–æ–Ω–µ
        if (this.isOnline && this.isGoogleSheetsReady) {
          try {
            // –ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º action='save-emotion' —Å emotion_action='remove'
            const params = new URLSearchParams({
              action: 'save-emotion',
              user_id: this.userId,
              date_key: dateKey,  // –ò–°–ü–†–ê–í–õ–ï–ù–û: date_key –≤–º–µ—Å—Ç–æ date
              emotion: '',  // –ü—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
              user_name: this.getUserName(),
              platform: this.getPlatform(),
              emotion_action: 'remove'  // –ò–°–ü–†–ê–í–õ–ï–ù–û: —É–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
            });

            const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
            console.log('üìä –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ:', url);
            
            const response = await fetch(url, {
              method: 'GET'  // –ò–°–ü–†–ê–í–õ–ï–ù–û: GET –≤–º–µ—Å—Ç–æ POST
            });
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.text();
            console.log('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç Google Sheets –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', result);
            
            if (result.includes('SUCCESS')) {
              console.log('‚úÖ –≠–º–æ—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ –∏–∑ Google Sheets:', dateKey);
              return true;
            } else {
              throw new Error(result || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
            }
            
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ Google Sheets:', error);
            return false;
          }
        } else {
          console.log('üíæ –≠–º–æ—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –∏–∑ localStorage (–æ—Ñ–ª–∞–π–Ω):', dateKey);
          return true;
        }
      }

      saveToLocalStorage(dateKey, emotion) {
        const startTime = performance.now();
        try {
          const currentData = localStorage.getItem(this.STORAGE_KEYS.EMOTIONS);
          const emotions = currentData ? JSON.parse(currentData) : {};
          emotions[dateKey] = emotion;
          localStorage.setItem(this.STORAGE_KEYS.EMOTIONS, JSON.stringify(emotions));
          
          const saveTime = performance.now() - startTime;
          console.log(`üîç [–ü–†–û–§–ò–õ–¨] saveToLocalStorage: ${saveTime.toFixed(2)}ms`);
          
          if (saveTime > 50) {
            console.warn(`‚ö†Ô∏è [–ü–†–û–§–ò–õ–¨] –ú–ï–î–õ–ï–ù–ù–´–ô localStorage save: ${saveTime.toFixed(2)}ms`);
          }
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
        }
      }

      removeFromLocalStorage(dateKey) {
        const startTime = performance.now();
        try {
          const currentData = localStorage.getItem(this.STORAGE_KEYS.EMOTIONS);
          const emotions = currentData ? JSON.parse(currentData) : {};
          delete emotions[dateKey];
          localStorage.setItem(this.STORAGE_KEYS.EMOTIONS, JSON.stringify(emotions));
          
          const removeTime = performance.now() - startTime;
          console.log(`üîç [–ü–†–û–§–ò–õ–¨] removeFromLocalStorage: ${removeTime.toFixed(2)}ms`);
          
          if (removeTime > 50) {
            console.warn(`‚ö†Ô∏è [–ü–†–û–§–ò–õ–¨] –ú–ï–î–õ–ï–ù–ù–´–ô localStorage remove: ${removeTime.toFixed(2)}ms`);
          }
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ localStorage:', error);
        }
      }

      saveAllToLocalStorage(emotions) {
        try {
          localStorage.setItem(this.STORAGE_KEYS.EMOTIONS, JSON.stringify(emotions));
          console.log('üíæ –í—Å–µ —ç–º–æ—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', Object.keys(emotions).length);
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —ç–º–æ—Ü–∏–π –≤ localStorage:', error);
        }
      }

      // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
      getUserName() {
        try {
          const telegramUser = window.Telegram?.WebApp?.initDataUnsafe?.user;
          if (telegramUser) {
            return `${telegramUser.first_name || ''} ${telegramUser.last_name || ''}`.trim();
          }
          return '';
        } catch (error) {
          return '';
        }
      }

      getPlatform() {
        try {
          if (window.Telegram?.WebApp?.platform) {
            return window.Telegram.WebApp.platform;
          }
          return 'web';
        } catch (error) {
          return 'web';
        }
      }
    }

    // –ù–ê–ô–î–ò–¢–ï –∏ –ó–ê–ú–ï–ù–ò–¢–ï –≤–µ—Å—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:
constructor() {
  this.emotions = {};
  this.selectedDate = null;
  this.googleSheetsService = new GoogleSheetsService();
  
  this.currentWeekOffset = 0;
  
  this.initializeElements();
  this.setupEventListeners();
  
  // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
  this.initializeEmotions();
}
    // –î–û–ë–ê–í–¨–¢–ï —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –ü–û–°–õ–ï –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:
async initializeEmotions() {
  console.log('üöÄ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ—Ü–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—è...');
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ localStorage
  const localEmotions = this.googleSheetsService.loadEmotionsInstantly();
  
  if (localEmotions && Object.keys(localEmotions).length > 0) {
    // –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
    this.emotions = localEmotions;
    this.renderCalendar();
    console.log(`‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage: ${Object.keys(localEmotions).length} —ç–º–æ—Ü–∏–π`);
    
    // –í —Ñ–æ–Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º—Å—è –¥–ª—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    setTimeout(() => this.syncWithGoogleSheets(), 1000);
    
  } else {
    // localStorage –ø—É—Å—Ç–æ–π - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ Google Sheets
    console.log('üíæ localStorage –ø—É—Å—Ç–æ–π - –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –∏–∑ Google Sheets...');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º
    this.emotions = {};
    this.renderCalendar();
    
    try {
      // –ñ–¥–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
      const restoredEmotions = await this.googleSheetsService.loadFromGoogleSheetsSync();
      
      if (restoredEmotions && Object.keys(restoredEmotions).length > 0) {
        this.emotions = restoredEmotions;
        this.renderCalendar(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        console.log(`üéâ –£–°–ü–ï–®–ù–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–û ${Object.keys(restoredEmotions).length} —ç–º–æ—Ü–∏–π!`);
      } else {
        console.log('üì≠ –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —ç–º–æ—Ü–∏–π –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è');
      }
      
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
    }
    
    // –í —Ñ–æ–Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
    setTimeout(() => this.syncWithGoogleSheets(), 2000);
  }
}

      initializeElements() {
        this.calendarDaysGrid = document.getElementById('calendarDaysGrid');
        this.currentMonthElement = document.getElementById('currentMonth');
        this.emotionModal = document.getElementById('emotionModal');
        this.prevMonthBtn = document.getElementById('prevMonth');
        this.nextMonthBtn = document.getElementById('nextMonth');
      }

      setupEventListeners() {
        // Modal events
        this.emotionModal.addEventListener('click', (e) => {
          if (e.target === this.emotionModal) {
            this.closeModal();
          }
        });

        document.getElementById('closeModal').addEventListener('click', () => {
          this.closeModal();
        });

        // Emotion options - ‚ö° –ò–°–ü–†–ê–í–õ–ï–ù–û: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
        document.querySelectorAll('.emotion-option').forEach(option => {
          option.addEventListener('click', () => {
            const emotion = option.dataset.emotion;
            
            // ‚ö° –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –≤–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ë–ï–ó –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
            option.style.transform = 'scale(0.95)';
            option.style.opacity = '0.7';
            
            setTimeout(() => {
              option.style.transform = '';
              option.style.opacity = '';
            }, 150);
            
            this.setEmotionInstantly(emotion); // ‚ö° –ù–û–í–´–ô –º–µ—Ç–æ–¥!
          });
        });

        // Week navigation (–ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏)
        this.prevMonthBtn.addEventListener('click', () => {
          this.changeWeek(-1);
        });

        this.nextMonthBtn.addEventListener('click', () => {
          this.changeWeek(1);
        });
      }

      changeWeek(direction) {
        this.currentWeekOffset += direction;
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ –Ω–µ–¥–µ–ª—è–º (–±—ã—Å—Ç—Ä–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
        trackWeekNavigation(direction > 0 ? 'next' : 'prev', this.currentWeekOffset);
        
        this.renderCalendar();
      }

      loadEmotionsInstantly() {
        console.log('‚ö° –ú–ì–ù–û–í–ï–ù–ù–ê–Ø –∑–∞–≥—Ä—É–∑–∫–∞ —ç–º–æ—Ü–∏–π –≤ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ...');
        this.emotions = this.googleSheetsService.loadEmotionsInstantly(); // –ó–∞–º–µ–Ω–∏–ª–∏ Firebase –Ω–∞ Google Sheets
        const count = Object.keys(this.emotions).length;
        console.log(`‚úÖ –≠–º–æ—Ü–∏–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é: ${count}`);
        return this.emotions;
      }

      // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –º–µ—Ç–æ–¥ syncWithGoogleSheets - –ù–ï –û–ë–ù–£–õ–Ø–ï–¢ –î–ê–ù–ù–´–ï
      async syncWithGoogleSheets() {
        console.log('üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è —Å Google Sheets –≤ —Ñ–æ–Ω–µ...');
        const googleSheetsEmotions = await this.googleSheetsService.syncWithGoogleSheets();
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—É—Å—Ç—ã–µ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
        if (googleSheetsEmotions && Object.keys(googleSheetsEmotions).length > 0) {
          const newEmotions = { ...this.emotions, ...googleSheetsEmotions };
          
          const hasChanges = JSON.stringify(this.emotions) !== JSON.stringify(newEmotions);
          
          if (hasChanges) {
            console.log('üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å');
            this.emotions = newEmotions;
            this.renderCalendar();
          } else {
            console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç');
          }
        } else {
          // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º (–Ω–µ –æ–±–Ω—É–ª—è–µ–º this.emotions)
          console.log('‚ÑπÔ∏è Google Sheets –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–º–æ—Ü–∏–∏');
        }
      }

      getLocalizedMonthNames() {
        const currentLang = window.translator ? window.translator.currentLang : 'en';
        
        if (currentLang === 'en') {
          return [
            'January', 'February', 'March', 'April', 'May', 'June',
            'July', 'August', 'September', 'October', 'November', 'December'
          ];
        } else {
          return [
            '–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
            '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'
          ];
        }
      }

      renderCalendar() {
        const startTime = performance.now();
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –ù–∞—á–∞–ª–æ renderCalendar`);
        
        // –≠–¢–ê–ü 1: –û—á–∏—Å—Ç–∫–∞ DOM
        const clearStart = performance.now();
        this.calendarDaysGrid.innerHTML = '';
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –û—á–∏—Å—Ç–∫–∞ DOM: ${(performance.now() - clearStart).toFixed(2)}ms`);
        
        // –≠–¢–ê–ü 2: –í—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∞—Ç
        const calcStart = performance.now();
        const today = DateUtils.getCurrentDateInUserTimezone();
        const currentDayOfWeek = today.getDay();
        const mondayOffset = currentDayOfWeek === 0 ? 6 : currentDayOfWeek - 1;
        
        const currentMonday = new Date(today);
        currentMonday.setDate(today.getDate() - mondayOffset);
        
        const targetMonday = new Date(currentMonday);
        targetMonday.setDate(currentMonday.getDate() + (this.currentWeekOffset * 7));
        
        const previousMonday = new Date(targetMonday);
        previousMonday.setDate(targetMonday.getDate() - 7);

        const middleDate = new Date(previousMonday);
        middleDate.setDate(previousMonday.getDate() + 7);
        
        const monthNames = this.getLocalizedMonthNames();
        const currentMonth = monthNames[middleDate.getMonth()];
        const currentYear = middleDate.getFullYear();
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –í—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∞—Ç: ${(performance.now() - calcStart).toFixed(2)}ms`);
        
        // –≠–¢–ê–ü 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        const headerStart = performance.now();
        this.currentMonthElement.textContent = `${currentMonth} ${currentYear}`;
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞: ${(performance.now() - headerStart).toFixed(2)}ms`);

        // –≠–¢–ê–ü 4: –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –¥–Ω–µ–π
        const arrayStart = performance.now();
        const daysToShow = [];
        for (let i = 0; i < 14; i++) {
          const date = new Date(previousMonday);
          date.setDate(previousMonday.getDate() + i);
          daysToShow.push(date);
        }
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ –¥–Ω–µ–π: ${(performance.now() - arrayStart).toFixed(2)}ms`);

        // –≠–¢–ê–ü 5: –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM (–°–ê–ú–ê–Ø –ú–ï–î–õ–ï–ù–ù–ê–Ø –ß–ê–°–¢–¨!)
        const domStart = performance.now();
        const fragment = document.createDocumentFragment(); // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è DOM
        
        daysToShow.forEach(date => {
          const dayElement = this.createDayElement(date);
          fragment.appendChild(dayElement);
        });
        
        this.calendarDaysGrid.appendChild(fragment); // –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–º–µ—Å—Ç–æ 14
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –°–æ–∑–¥–∞–Ω–∏–µ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${(performance.now() - domStart).toFixed(2)}ms`);

        const totalTime = performance.now() - startTime;
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] –û–ë–©–ï–ï –í–†–ï–ú–Ø renderCalendar: ${totalTime.toFixed(2)}ms`);
        
        if (totalTime > 50) {
          console.warn(`‚ö†Ô∏è [–ü–†–û–§–ò–õ–¨] –ú–ï–î–õ–ï–ù–ù–´–ô –†–ï–ù–î–ï–†–ò–ù–ì! renderCalendar –∑–∞–Ω—è–ª–∞ ${totalTime.toFixed(2)}ms`);
        }
      }

      createDayElement(date) {
        const startTime = performance.now();
        
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        
        // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É: —ç–º–æ—Ü–∏—è —Å–≤–µ—Ä—Ö—É, –¥–∞—Ç–∞ —Å–Ω–∏–∑—É (–∫–∞–∫ –≤ journal.html)
        const emotionElement = document.createElement('div');
        emotionElement.className = 'calendar-day-emotion';
        
        const numberElement = document.createElement('div');
        numberElement.className = 'calendar-day-number';
        numberElement.textContent = date.getDate();
        
        dayElement.appendChild(emotionElement);
        dayElement.appendChild(numberElement);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∞—Ç–∞ –±—É–¥—É—â–µ–π
        const today = DateUtils.getCurrentDateInUserTimezone();
        today.setHours(23, 59, 59, 999);
        date.setHours(0, 0, 0, 0);
        
        const isFutureDate = date > today;

        if (isFutureDate) {
          dayElement.classList.add('future-date');
          return dayElement;
        }

        const dateKey = `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
        dayElement.setAttribute('data-date', dateKey);
        
        const isToday = DateUtils.isTodayInUserTimezone(date);
        const hasEmotion = this.emotions[dateKey];
        
        if (isToday) {
          dayElement.classList.add('today');
        }
        
        if (hasEmotion) {
          dayElement.classList.add('has-emotion', `emotion-${hasEmotion}`);
        }

        // –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, –Ω–µ –≤ —Ü–∏–∫–ª–µ
        dayElement.addEventListener('click', () => {
          this.openModal(dateKey);
        });

        const createTime = performance.now() - startTime;
        if (createTime > 5) {
          console.log(`üîç [–ü–†–û–§–ò–õ–¨] createDayElement –º–µ–¥–ª–µ–Ω–Ω–æ: ${createTime.toFixed(2)}ms –¥–ª—è ${dateKey}`);
        }

        return dayElement;
      }

      openModal(dateKey) {
        this.selectedDate = dateKey;
        
        const [year, month, day] = dateKey.split('-').map(Number);
        const date = new Date(year, month, day);
        const dateText = this.formatSelectedDate(date);
        document.getElementById('selectedDateText').textContent = dateText;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–Ω–∏–º–∞—Ü–∏–∏
        document.body.classList.add('modal-open');
        
        this.emotionModal.classList.add('active');
      }

      formatSelectedDate(date) {
        const currentLang = window.translator ? window.translator.currentLang : 'en';
        
        const dayNames = currentLang === 'en' ? 
          ['SUNDAY', 'MONDAY', 'TUESDAY', 'WEDNESDAY', 'THURSDAY', 'FRIDAY', 'SATURDAY'] :
          ['–í–û–°–ö–†–ï–°–ï–ù–¨–ï', '–ü–û–ù–ï–î–ï–õ–¨–ù–ò–ö', '–í–¢–û–†–ù–ò–ö', '–°–†–ï–î–ê', '–ß–ï–¢–í–ï–†–ì', '–ü–Ø–¢–ù–ò–¶–ê', '–°–£–ë–ë–û–¢–ê'];
        
        const monthNames = currentLang === 'en' ? 
          ['JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE', 'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'] :
          ['–Ø–ù–í–ê–†–Ø', '–§–ï–í–†–ê–õ–Ø', '–ú–ê–†–¢–ê', '–ê–ü–†–ï–õ–Ø', '–ú–ê–Ø', '–ò–Æ–ù–Ø', '–ò–Æ–õ–Ø', '–ê–í–ì–£–°–¢–ê', '–°–ï–ù–¢–Ø–ë–†–Ø', '–û–ö–¢–Ø–ë–†–Ø', '–ù–û–Ø–ë–†–Ø', '–î–ï–ö–ê–ë–†–Ø'];
        
        const dayName = dayNames[date.getDay()];
        const day = date.getDate();
        const month = monthNames[date.getMonth()];
        const year = date.getFullYear();
        
        if (currentLang === 'en') {
          return `${dayName}, ${month} ${day}, ${year}`;
        } else {
          return `${dayName}, ${day} ${month} ${year} –ì.`;
        }
      }

      closeModal() {
        const startTime = performance.now();
        
        this.emotionModal.classList.remove('active');
        
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
        document.body.classList.remove('modal-open');
        
        this.selectedDate = null;
        
        const closeTime = performance.now() - startTime;
        console.log(`üîç [–ü–†–û–§–ò–õ–¨] closeModal: ${closeTime.toFixed(2)}ms`);
        
        if (closeTime > 20) {
          console.warn(`‚ö†Ô∏è [–ü–†–û–§–ò–õ–¨] –ú–ï–î–õ–ï–ù–ù–û–ï –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∞: ${closeTime.toFixed(2)}ms`);
        }
      }

      // ‚ö° –ö–õ–Æ–ß–ï–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π setEmotion –ë–ï–ó –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ UI
      setEmotionInstantly(emotion) {
        if (!this.selectedDate) return;
        
        const totalStartTime = performance.now();
        console.log(`‚ö° –ú–ì–ù–û–í–ï–ù–ù–ê–Ø —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º–æ—Ü–∏–∏: ${emotion} –¥–ª—è –¥–∞—Ç—ã: ${this.selectedDate}`);
        
        const isRemoving = this.emotions[this.selectedDate] === emotion;
        
        try {
          // ‚ö° 1. –ú–ì–ù–û–í–ï–ù–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          if (isRemoving) {
            delete this.emotions[this.selectedDate];
            console.log(`üóëÔ∏è –≠–º–æ—Ü–∏—è ${emotion} –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –¥–ª—è ${this.selectedDate}`);
            
            // ‚ö° –ê–°–ò–ù–•–†–û–ù–ù–û —É–¥–∞–ª—è–µ–º –≤ —Ñ–æ–Ω–µ –ë–ï–ó await
            this.googleSheetsService.deleteEmotionAsync(this.selectedDate);
            trackEmotionRemove(emotion, this.selectedDate);
          } else {
            this.emotions[this.selectedDate] = emotion;
            console.log(`‚úÖ –≠–º–æ—Ü–∏—è ${emotion} –º–≥–Ω–æ–≤–µ–Ω–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è ${this.selectedDate}`);
            
            // ‚ö° –ê–°–ò–ù–•–†–û–ù–ù–û —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–æ–Ω–µ –ë–ï–ó await
            this.googleSheetsService.saveEmotionAsync(this.selectedDate, emotion);
            trackEmotionSet(emotion, this.selectedDate);
          }
          
          // ‚ö° 2. –ú–ì–ù–û–í–ï–ù–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º UI
          this.renderCalendar();
          this.closeModal();
          
          const totalTime = performance.now() - totalStartTime;
          window.perfDebugger.logEmotionSetComplete(totalTime);
          
          console.log(`‚ö° –û–ë–©–ï–ï –í–†–ï–ú–Ø setEmotionInstantly: ${totalTime.toFixed(2)}ms`);
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–µ —ç–º–æ—Ü–∏–∏:', error);
        }
      }

      // –°–¢–ê–†–´–ô –º–µ–¥–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ - –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
      async setEmotion(emotion) {
        if (!this.selectedDate || this.isLoading) return;
        
        this.isLoading = true;
        console.log(`üé≠ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º–æ—Ü–∏–∏: ${emotion} –¥–ª—è –¥–∞—Ç—ã: ${this.selectedDate}`);
        
        const isRemoving = this.emotions[this.selectedDate] === emotion;
        
        try {
          if (isRemoving) {
            delete this.emotions[this.selectedDate];
            await this.googleSheetsService.deleteEmotion(this.selectedDate); // –ó–∞–º–µ–Ω–∏–ª–∏ Firebase –Ω–∞ Google Sheets
            trackEmotionRemove(emotion, this.selectedDate);
            console.log(`üóëÔ∏è –≠–º–æ—Ü–∏—è ${emotion} —É–¥–∞–ª–µ–Ω–∞ –¥–ª—è ${this.selectedDate}`);
          } else {
            this.emotions[this.selectedDate] = emotion;
            await this.googleSheetsService.saveEmotion(this.selectedDate, emotion); // –ó–∞–º–µ–Ω–∏–ª–∏ Firebase –Ω–∞ Google Sheets
            trackEmotionSet(emotion, this.selectedDate);
            console.log(`‚úÖ –≠–º–æ—Ü–∏—è ${emotion} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è ${this.selectedDate}`);
          }
          
          // –ú–ì–ù–û–í–ï–ù–ù–û –æ–±–Ω–æ–≤–ª—è–µ–º UI –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
          this.renderCalendar();
          this.closeModal();
          
        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —ç–º–æ—Ü–∏–∏:', error);
        } finally {
          this.isLoading = false;
        }
      }
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô Translator class —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ —è–∑—ã–∫–∞
    class Translator {
      constructor() {
        console.log('üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ INDEX.HTML...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
        this.localStorageAvailable = this.checkLocalStorageAvailability();
        
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º Telegram:
        // 1. URL –ø–∞—Ä–∞–º–µ—Ç—Ä (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ —É–∫–∞–∑–∞–ª)
        // 2. localStorage (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –º–µ–Ω—è–ª —è–∑—ã–∫ —Ä–∞–Ω–µ–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤—ã–±–æ—Ä)  
        // 3. Telegram —è–∑—ã–∫ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â–µ –Ω–µ –º–µ–Ω—è–ª —è–∑—ã–∫ –≤—Ä—É—á–Ω—É—é)
        // 4. 'en' –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        
        const urlLang = this.getLanguageFromURL();
        const storedLang = this.localStorageAvailable ? this.getLanguageFromStorage() : null;
        const telegramLang = this.getTelegramLanguage();
        
        if (urlLang) {
          this.currentLang = urlLang;
          console.log(`üîó –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ URL: ${urlLang}`);
        } else if (storedLang) {
          this.currentLang = storedLang;
          console.log(`üíæ –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —è–∑—ã–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${storedLang}`);
        } else if (telegramLang) {
          this.currentLang = telegramLang;
          console.log(`üì± –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –∏–∑ Telegram: ${telegramLang}`);
        } else {
          this.currentLang = 'en';
          console.log(`üåê –ò—Å–ø–æ–ª—å–∑—É–µ–º —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: en`);
        }
        
        console.log(`‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —è–∑—ã–∫: ${this.currentLang}`);
        console.log(`üìç –ò—Å—Ç–æ—á–Ω–∏–∫: ${this.getLanguageSource()}`);
        console.log(`üíæ localStorage: ${this.localStorageAvailable ? '–¥–æ—Å—Ç—É–ø–µ–Ω' : '–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (Claude Artifacts)'}`);
        
        this.init();
      }

      checkLocalStorageAvailability() {
        try {
          const testKey = 'test_storage_' + Date.now();
          localStorage.setItem(testKey, 'test');
          localStorage.removeItem(testKey);
          return true;
        } catch (error) {
          console.log(`‚ö†Ô∏è localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`);
          return false;
        }
      }

      getLanguageFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const langFromUrl = urlParams.get('lang');
        console.log(`üîó –Ø–∑—ã–∫ –∏–∑ URL: ${langFromUrl}`);
        return langFromUrl;
      }

      getLanguageFromStorage() {
        if (!this.localStorageAvailable) return null;
        
        try {
          const langFromStorage = localStorage.getItem('potok_language');
          console.log(`üíæ –Ø–∑—ã–∫ –∏–∑ localStorage: ${langFromStorage}`);
          return langFromStorage;
        } catch (error) {
          console.log(`‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è localStorage: ${error.message}`);
          return null;
        }
      }

      getTelegramLanguage() {
        try {
          if (window.Telegram?.WebApp?.initDataUnsafe?.user?.language_code) {
            const telegramLang = window.Telegram.WebApp.initDataUnsafe.user.language_code;
            console.log('üì± –Ø–∑—ã–∫ –∏–∑ Telegram:', telegramLang);
            
            if (telegramLang === 'ru' || telegramLang.startsWith('ru')) {
              return 'ru';
            }
            return 'en';
          }
          
          console.log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ —è–∑—ã–∫–∞ Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
          return null;
        } catch (error) {
          console.log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —è–∑—ã–∫–∞ Telegram:', error);
          return null;
        }
      }

      getLanguageSource() {
        if (this.getLanguageFromURL()) return 'URL –ø–∞—Ä–∞–º–µ—Ç—Ä (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∫–∞–∑–∞–ª)';
        if (this.localStorageAvailable && this.getLanguageFromStorage()) return 'localStorage (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–ª)';
        if (this.getTelegramLanguage()) return 'Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
        return '–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (en)';
      }

      init() {
        this.updatePage();
        this.updateLanguageButtons();
        this.updatePageLinks();
        this.setupLanguageButtons();
        document.documentElement.lang = this.currentLang;
        document.title = this.translate('page_title');
        
        console.log(`‚úÖ –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫ INDEX.HTML –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —è–∑—ã–∫–æ–º: ${this.currentLang}`);
      }

      setupLanguageButtons() {
        document.getElementById('enBtn')?.addEventListener('click', () => {
          console.log('üîò –ö–ª–∏–∫ –ø–æ EN –≤ INDEX.HTML');
          this.setLanguage('en');
        });
        
        document.getElementById('ruBtn')?.addEventListener('click', () => {
          console.log('üîò –ö–ª–∏–∫ –ø–æ RU –≤ INDEX.HTML');
          this.setLanguage('ru');
        });
      }

      setLanguage(lang) {
        console.log(`üîÑ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ –í–†–£–ß–ù–£–Æ —Å–º–µ–Ω–∏–ª —è–∑—ã–∫ –Ω–∞: ${lang} –≤ INDEX.HTML`);
        
        this.currentLang = lang;
        
        // –í–ê–ñ–ù–û: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –í–†–£–ß–ù–£–Æ –º–µ–Ω—è–µ—Ç —è–∑—ã–∫, –º—ã –í–°–ï–ì–î–ê —Å–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–æ
        if (this.localStorageAvailable) {
          try {
            localStorage.setItem('potok_language', lang);
            console.log(`‚úÖ –Ø–∑—ã–∫ ${lang} —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ localStorage (–≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)`);
          } catch (error) {
            console.log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage: ${error.message}`);
          }
        } else {
          console.log(`‚ö†Ô∏è localStorage –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ URL —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é`);
        }
        
        // –í–°–ï–ì–î–ê –æ–±–Ω–æ–≤–ª—è–µ–º URL
        try {
          const newUrl = `${window.location.pathname}?lang=${lang}`;
          window.history.replaceState({}, '', newUrl);
          console.log(`‚úÖ URL –æ–±–Ω–æ–≤–ª–µ–Ω: ${newUrl}`);
        } catch (error) {
          console.log(`‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å URL: ${error.message}`);
        }
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–º–µ–Ω—É —è–∑—ã–∫–∞ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
        trackEvent('language_changed', {
          new_language: lang,
          source: 'user_manual_selection',
          user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'anonymous'
        });
        
        this.updatePage();
        this.updateLanguageButtons();
        this.updatePageLinks();
        
        if (window.potokApp && typeof window.potokApp.updateLinksWithLanguage === 'function') {
          window.potokApp.updateLinksWithLanguage(lang);
        }
        
        if (window.compactCalendar) {
          window.compactCalendar.renderCalendar();
        }
        
        document.documentElement.lang = lang;
        document.title = this.translate('page_title');
        
        console.log(`üåê –Ø–∑—ã–∫ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞: ${lang} –≤ INDEX.HTML (–≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω)`);
      }

      updatePageLinks() {
        // –û–±–Ω–æ–≤–ª—è–µ–º –í–°–ï —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —è–∑—ã–∫–∞
        const links = document.querySelectorAll('a[href$=".html"], a[href*=".html"]');
        let updateCount = 0;
        
        links.forEach(link => {
          let href = link.getAttribute('href');
          
          // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏
          if (href.startsWith('http') || href.startsWith('//')) return;
          
          // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä lang –µ—Å–ª–∏ –µ—Å—Ç—å
          if (href.includes('?lang=')) {
            href = href.split('?')[0];
          }
          
          // –£–±–∏—Ä–∞–µ–º —è–∫–æ—Ä—è –∏ query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫—Ä–æ–º–µ lang
          if (href.includes('#')) {
            const parts = href.split('#');
            href = parts[0];
          }
          
          // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä lang
          const separator = href.includes('?') ? '&' : '?';
          const newHref = `${href}${separator}lang=${this.currentLang}`;
          link.setAttribute('href', newHref);
          updateCount++;
        });
        
        console.log(`üîó –û–±–Ω–æ–≤–ª–µ–Ω–æ ${updateCount} —Å—Å—ã–ª–æ–∫ —Å lang=${this.currentLang} –≤ INDEX.HTML`);
      }

      translate(key) {
        return translations[this.currentLang]?.[key] || translations.en[key] || key;
      }

      updatePage() {
        // Update all elements with data-translate attribute
        document.querySelectorAll('[data-translate]').forEach(element => {
          const key = element.getAttribute('data-translate');
          const translation = this.translate(key);
          
          if (element.tagName === 'TITLE') {
            element.textContent = translation;
          } else {
            element.textContent = translation;
          }
        });
        
        console.log(`üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ ${document.querySelectorAll('[data-translate]').length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–∞`);
      }

      updateLanguageButtons() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.textContent.toLowerCase() === this.currentLang) {
            btn.classList.add('active');
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç
            btn.style.background = 'linear-gradient(135deg, #FFD527 8%, #34A853 85%, #4285F4 98%)';
          } else {
            btn.style.background = '';
          }
        });
      }
    }

    // Telegram App class —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
    class PotokTelegramApp {
      constructor() {
        this.tg = window.Telegram?.WebApp;
        this.user = null;
        this.init();
      }

      async init() {
        this.initTelegramWebApp();
        this.setupEventListeners();
        
        if (this.user && this.user.id) {
          // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          trackEvent('user_entered_app', {
            user_id: this.user.id,
            first_name: this.user.first_name,
            language_code: this.user.language_code,
            platform: this.tg?.platform || 'unknown'
          });
          
          setTimeout(() => {
            this.trackPageEntry();
          }, 1000);
        }
      }

      initTelegramWebApp() {
        if (!this.tg) {
          console.log('‚ö†Ô∏è Telegram Web App –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–µ–∂–∏–º –±—Ä–∞—É–∑–µ—Ä–∞');
          // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –≤–µ–±-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
          trackEvent('browser_user_entered', {
            user_agent: navigator.userAgent,
            platform: 'web'
          });
          return;
        }

        this.tg.ready();
        this.tg.setHeaderColor('#19191B');
        this.tg.setBackgroundColor('#19191B');
        this.tg.expand();
        this.tg.enableClosingConfirmation();
        this.tg.MainButton.hide();
        this.tg.BackButton.hide();
        
        this.user = this.tg.initDataUnsafe?.user;
        if (this.user) {
          console.log('üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram:', this.user.first_name, '–Ø–∑—ã–∫:', this.user.language_code);
          this.updateUserHeader();
        } else {
          console.log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã');
        }
      }

      updateUserHeader() {
        if (!this.user) return;
        
        const currentLang = window.translator ? window.translator.currentLang : 'en';
        const profileUrl = `profile.html?lang=${currentLang}`;
        
        const headerLogo = document.getElementById('headerLogo');
        headerLogo.innerHTML = `
          <a href="${profileUrl}" class="user-header">
            <div class="user-avatar">
              ${this.user.photo_url ? 
                `<img src="${this.user.photo_url}" alt="${this.user.first_name}" class="avatar-image">` :
                `<div class="avatar-placeholder">${this.user.first_name?.charAt(0).toUpperCase() || 'U'}</div>`
              }
            </div>
            <div class="user-name">${this.user.first_name || 'User'}</div>
          </a>
        `;

        if (window.translator && typeof window.translator.updatePageLinks === 'function') {
          setTimeout(() => {
            window.translator.updatePageLinks();
          }, 100);
        }
      }

      updateLinksWithLanguage(lang) {
        const headerLinks = document.getElementById('headerLogo')?.querySelectorAll('a[href*=".html"]');
        if (headerLinks) {
          headerLinks.forEach(link => {
            let href = link.getAttribute('href');
            if (href.includes('?lang=')) {
              href = href.split('?')[0];
            }
            link.setAttribute('href', `${href}?lang=${lang}`);
          });
        }
      }

      async trackPageEntry() {
        try {
          if (!this.user || !this.user.id) {
            console.log('‚è≠Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ - –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram');
            return;
          }

          const userData = {
            user_id: this.user.id,
            first_name: this.user.first_name || '',
            last_name: this.user.last_name || '',
            username: this.user.username || '',
            language_code: this.user.language_code || '',
            entry_time: new Date().toISOString(),
            page: 'index',
            user_agent: navigator.userAgent,
            platform: this.tg?.platform || 'unknown',
            action: 'track-entry'
          };

          console.log('üìä –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userData);

          const params = new URLSearchParams({
            user_id: userData.user_id,
            first_name: userData.first_name,
            last_name: userData.last_name,
            username: userData.username,
            language_code: userData.language_code,
            page: userData.page,
            platform: userData.platform,
            action: 'track-entry'
          });

          const img = new Image();
          img.onload = () => console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
          img.onerror = () => console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
          img.src = `https://script.google.com/macros/s/AKfycbw7Fk8czSiLvjjONtja6GwK1jDeczv4LAnfkHG1L21GlbSahR0bVSdTfU1ZqJ8Pl4pn7A/exec?${params}`;

        } catch (error) {
          console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ö–æ–¥–∞:', error);
        }
      }

      setupEventListeners() {
        document.querySelectorAll('.card').forEach(card => {
          card.addEventListener('click', (e) => {
            const title = e.currentTarget.querySelector('.card-title')?.textContent;
            
            this.handlePracticeClick(title);
            this.triggerHapticFeedback('light');
          });
        });

        document.querySelectorAll('.tab').forEach(tab => {
          tab.addEventListener('click', (e) => {
            const tabName = e.currentTarget.querySelector('div')?.textContent;
            
            trackEvent('navigation_click', {
              tab: tabName,
              user_id: this.user?.id || 'anonymous',
              page_from: 'index'
            });
            this.triggerHapticFeedback('selection');
          });
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∫–ª–∏–∫–∞ –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        document.addEventListener('click', (e) => {
          if (e.target.closest('.user-header')) {
            trackEvent('profile_click', {
              user_id: this.user?.id || 'anonymous',
              source_page: 'index',
              destination: 'journal'
            });
            this.triggerHapticFeedback('selection');
          }
        });
      }

      handlePracticeClick(practiceType) {
        trackEvent('practice_started', {
          practice_type: practiceType,
          user_id: this.user?.id || 'anonymous',
          source_page: 'index',
          timestamp: Date.now()
        });
      }

      triggerHapticFeedback(type = 'light') {
        if (this.tg?.HapticFeedback) {
          switch (type) {
            case 'light':
              this.tg.HapticFeedback.impactOccurred('light');
              break;
            case 'medium':
              this.tg.HapticFeedback.impactOccurred('medium');
              break;
            case 'heavy':
              this.tg.HapticFeedback.impactOccurred('heavy');
              break;
            case 'selection':
              this.tg.HapticFeedback.selectionChanged();
              break;
          }
        }
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function initializeApp() {
      console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å Google Sheets –≤–º–µ—Å—Ç–æ Firebase...');
      
      // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫
      window.translator = new Translator();
      
      // 2. Telegram App
      window.potokApp = new PotokTelegramApp();
      
      // 3. –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å (—Ç–µ–ø–µ—Ä—å —Å Google Sheets)
      window.compactCalendar = new CompactCalendar();
      
      // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      setTimeout(() => {
        trackEvent('app_fully_loaded', {
          page: 'index',
          load_time: Date.now(),
          user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 'anonymous',
          storage_type: 'google_sheets' // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        });
        
        // 5. –§–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫
        window.translator.updatePageLinks();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        console.log(`üîç [–î–ï–ë–ê–ì–ì–ï–†] –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:`);
        console.log(`üîç [–î–ï–ë–ê–ì–ì–ï–†] window.perfDebugger.generateReport() - –æ—Ç—á–µ—Ç –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏`);
        console.log(`üîç [–î–ï–ë–ê–ì–ì–ï–†] –í—ã–±–µ—Ä–∏—Ç–µ —ç–º–æ—Ü–∏—é –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–¥–µ—Ä–∂–µ–∫`);
      }, 1500);
    }

    // –ñ–¥–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Telegram WebApp –∏–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ DOMContentLoaded
    if (window.Telegram?.WebApp) {
      window.Telegram.WebApp.ready();
      setTimeout(initializeApp, 100);
    } else {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeApp);
      } else {
        initializeApp();
      }
    }
  </script>
</body>
</html>
